/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ri=Object.create;var Dt=Object.defineProperty;var ni=Object.getOwnPropertyDescriptor;var oi=Object.getOwnPropertyNames;var ai=Object.getPrototypeOf,ii=Object.prototype.hasOwnProperty;var si=(r,o)=>()=>(o||r((o={exports:{}}).exports,o),o.exports),li=(r,o)=>{for(var n in o)Dt(r,n,{get:o[n],enumerable:!0})},Wn=(r,o,n,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let l of oi(o))!ii.call(r,l)&&l!==n&&Dt(r,l,{get:()=>o[l],enumerable:!(s=ni(o,l))||s.enumerable});return r};var ui=(r,o,n)=>(n=r!=null?ri(ai(r)):{},Wn(o||!r||!r.__esModule?Dt(n,"default",{value:r,enumerable:!0}):n,r)),ci=r=>Wn(Dt({},"__esModule",{value:!0}),r);var Kn=si((At,Be)=>{var Tt=void 0,_t=function(r){return Tt||(Tt=new Promise(function(o,n){var s=typeof r!="undefined"?r:{},l=s.onAbort;s.onAbort=function(e){n(new Error(e)),l&&l(e)},s.postRun=s.postRun||[],s.postRun.push(function(){o(s)}),Be=void 0;var a;a||(a=typeof s!="undefined"?s:{});var c=typeof window=="object",p=typeof importScripts=="function",m=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";a.onRuntimeInitialized=function(){function e(f,w){switch(typeof w){case"boolean":ei(f,w?1:0);break;case"number":Ya(f,w);break;case"string":Xa(f,w,-1,-1);break;case"object":if(w===null)Vn(f);else if(w.length!=null){var x=wt(w,yt);Za(f,x,w.length,-1),Et(x)}else xt(f,"Wrong API use : tried to return a value of an unknown type ("+w+").",-1);break;default:Vn(f)}}function t(f,w){for(var x=[],$=0;$<f;$+=1){var N=ye(w+4*$,"i32"),O=Wa(N);if(O===1||O===2)N=Ja(N);else if(O===3)N=Qa(N);else if(O===4){O=N,N=Ka(O),O=Ga(O);for(var ce=new Uint8Array(N),ie=0;ie<N;ie+=1)ce[ie]=F[O+ie];N=ce}else N=null;x.push(N)}return x}function i(f,w){this.Ka=f,this.db=w,this.Ia=1,this.eb=[]}function u(f,w){if(this.db=w,w=Ke(f)+1,this.Xa=lr(w),this.Xa===null)throw Error("Unable to allocate memory for the SQL string");we(f,B,this.Xa,w),this.cb=this.Xa,this.Ta=this.hb=null}function d(f){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),f!=null){var w=this.filename,x="/",$=w;if(x&&(x=typeof x=="string"?x:pt(x),$=w?Ae(x+"/"+w):x),w=fn(!0,!0),$=mt($,(w!==void 0?w:438)&4095|32768,0),f){if(typeof f=="string"){x=Array(f.length);for(var N=0,O=f.length;N<O;++N)x[N]=f.charCodeAt(N);f=x}ft($,w|146),x=Fe($,577),Mn(x,f,0,f.length,0),rr(x),ft($,w)}}this.handleError(I(this.filename,g)),this.db=ye(g,"i32"),zn(this.db),this.Ya={},this.Ma={}}var g=De(4),v=a.cwrap,I=v("sqlite3_open","number",["string","number"]),U=v("sqlite3_close_v2","number",["number"]),M=v("sqlite3_exec","number",["number","string","number","number","number"]),Q=v("sqlite3_changes","number",["number"]),J=v("sqlite3_prepare_v2","number",["number","string","number","number","number"]),Fn=v("sqlite3_sql","string",["number"]),ka=v("sqlite3_normalized_sql","string",["number"]),Hn=v("sqlite3_prepare_v2","number",["number","number","number","number","number"]),Ia=v("sqlite3_bind_text","number",["number","number","number","number","number"]),Un=v("sqlite3_bind_blob","number",["number","number","number","number","number"]),$a=v("sqlite3_bind_double","number",["number","number","number"]),Ma=v("sqlite3_bind_int","number",["number","number","number"]),Ba=v("sqlite3_bind_parameter_index","number",["number","string"]),Pa=v("sqlite3_step","number",["number"]),Na=v("sqlite3_errmsg","string",["number"]),La=v("sqlite3_column_count","number",["number"]),qa=v("sqlite3_data_count","number",["number"]),Fa=v("sqlite3_column_double","number",["number","number"]),On=v("sqlite3_column_text","string",["number","number"]),Ha=v("sqlite3_column_blob","number",["number","number"]),Ua=v("sqlite3_column_bytes","number",["number","number"]),Oa=v("sqlite3_column_type","number",["number","number"]),Ra=v("sqlite3_column_name","string",["number","number"]),Va=v("sqlite3_reset","number",["number"]),ja=v("sqlite3_clear_bindings","number",["number"]),za=v("sqlite3_finalize","number",["number"]),Rn=v("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),Wa=v("sqlite3_value_type","number",["number"]),Ka=v("sqlite3_value_bytes","number",["number"]),Qa=v("sqlite3_value_text","string",["number"]),Ga=v("sqlite3_value_blob","number",["number"]),Ja=v("sqlite3_value_double","number",["number"]),Ya=v("sqlite3_result_double","",["number","number"]),Vn=v("sqlite3_result_null","",["number"]),Xa=v("sqlite3_result_text","",["number","string","number","number"]),Za=v("sqlite3_result_blob","",["number","number","number","number"]),ei=v("sqlite3_result_int","",["number","number"]),xt=v("sqlite3_result_error","",["number","string","number"]),jn=v("sqlite3_aggregate_context","number",["number","number"]),zn=v("RegisterExtensionFunctions","number",["number"]);i.prototype.bind=function(f){if(!this.Ka)throw"Statement closed";return this.reset(),Array.isArray(f)?this.vb(f):f!=null&&typeof f=="object"?this.wb(f):!0},i.prototype.step=function(){if(!this.Ka)throw"Statement closed";this.Ia=1;var f=Pa(this.Ka);switch(f){case 100:return!0;case 101:return!1;default:throw this.db.handleError(f)}},i.prototype.qb=function(f){return f==null&&(f=this.Ia,this.Ia+=1),Fa(this.Ka,f)},i.prototype.zb=function(f){if(f==null&&(f=this.Ia,this.Ia+=1),f=On(this.Ka,f),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(f)},i.prototype.Ab=function(f){return f==null&&(f=this.Ia,this.Ia+=1),On(this.Ka,f)},i.prototype.getBlob=function(f){f==null&&(f=this.Ia,this.Ia+=1);var w=Ua(this.Ka,f);f=Ha(this.Ka,f);for(var x=new Uint8Array(w),$=0;$<w;$+=1)x[$]=F[f+$];return x},i.prototype.get=function(f,w){w=w||{},f!=null&&this.bind(f)&&this.step(),f=[];for(var x=qa(this.Ka),$=0;$<x;$+=1)switch(Oa(this.Ka,$)){case 1:var N=w.useBigInt?this.zb($):this.qb($);f.push(N);break;case 2:f.push(this.qb($));break;case 3:f.push(this.Ab($));break;case 4:f.push(this.getBlob($));break;default:f.push(null)}return f},i.prototype.getColumnNames=function(){for(var f=[],w=La(this.Ka),x=0;x<w;x+=1)f.push(Ra(this.Ka,x));return f},i.prototype.getAsObject=function(f,w){f=this.get(f,w),w=this.getColumnNames();for(var x={},$=0;$<w.length;$+=1)x[w[$]]=f[$];return x},i.prototype.getSQL=function(){return Fn(this.Ka)},i.prototype.getNormalizedSQL=function(){return ka(this.Ka)},i.prototype.run=function(f){return f!=null&&this.bind(f),this.step(),this.reset()},i.prototype.mb=function(f,w){w==null&&(w=this.Ia,this.Ia+=1),f=dn(f);var x=wt(f,yt);this.eb.push(x),this.db.handleError(Ia(this.Ka,w,x,f.length-1,0))},i.prototype.ub=function(f,w){w==null&&(w=this.Ia,this.Ia+=1);var x=wt(f,yt);this.eb.push(x),this.db.handleError(Un(this.Ka,w,x,f.length,0))},i.prototype.lb=function(f,w){w==null&&(w=this.Ia,this.Ia+=1),this.db.handleError((f===(f|0)?Ma:$a)(this.Ka,w,f))},i.prototype.xb=function(f){f==null&&(f=this.Ia,this.Ia+=1),Un(this.Ka,f,0,0,0)},i.prototype.nb=function(f,w){switch(w==null&&(w=this.Ia,this.Ia+=1),typeof f){case"string":this.mb(f,w);return;case"number":this.lb(f,w);return;case"bigint":this.mb(f.toString(),w);return;case"boolean":this.lb(f+0,w);return;case"object":if(f===null){this.xb(w);return}if(f.length!=null){this.ub(f,w);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+f+")."},i.prototype.wb=function(f){var w=this;return Object.keys(f).forEach(function(x){var $=Ba(w.Ka,x);$!==0&&w.nb(f[x],$)}),!0},i.prototype.vb=function(f){for(var w=0;w<f.length;w+=1)this.nb(f[w],w+1);return!0},i.prototype.reset=function(){return this.freemem(),ja(this.Ka)===0&&Va(this.Ka)===0},i.prototype.freemem=function(){for(var f;(f=this.eb.pop())!==void 0;)Et(f)},i.prototype.free=function(){this.freemem();var f=za(this.Ka)===0;return delete this.db.Ya[this.Ka],this.Ka=0,f},u.prototype.next=function(){if(this.Xa===null)return{done:!0};if(this.Ta!==null&&(this.Ta.free(),this.Ta=null),!this.db.db)throw this.fb(),Error("Database closed");var f=Ze(),w=De(4);We(g),We(w);try{this.db.handleError(Hn(this.db.db,this.cb,-1,g,w)),this.cb=ye(w,"i32");var x=ye(g,"i32");return x===0?(this.fb(),{done:!0}):(this.Ta=new i(x,this.db),this.db.Ya[x]=this.Ta,{value:this.Ta,done:!1})}catch($){throw this.hb=Gt(this.cb),this.fb(),$}finally{Xe(f)}},u.prototype.fb=function(){Et(this.Xa),this.Xa=null},u.prototype.getRemainingSQL=function(){return this.hb!==null?this.hb:Gt(this.cb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(u.prototype[Symbol.iterator]=function(){return this}),d.prototype.run=function(f,w){if(!this.db)throw"Database closed";if(w){f=this.prepare(f,w);try{f.step()}finally{f.free()}}else this.handleError(M(this.db,f,0,0,g));return this},d.prototype.exec=function(f,w,x){if(!this.db)throw"Database closed";var $=Ze(),N=null;try{var O=ir(f),ce=De(4);for(f=[];ye(O,"i8")!==0;){We(g),We(ce),this.handleError(Hn(this.db,O,-1,g,ce));var ie=ye(g,"i32");if(O=ye(ce,"i32"),ie!==0){var ne=null;for(N=new i(ie,this),w!=null&&N.bind(w);N.step();)ne===null&&(ne={columns:N.getColumnNames(),values:[]},f.push(ne)),ne.values.push(N.get(null,x));N.free()}}return f}catch(de){throw N&&N.free(),de}finally{Xe($)}},d.prototype.each=function(f,w,x,$,N){typeof w=="function"&&($=x,x=w,w=void 0),f=this.prepare(f,w);try{for(;f.step();)x(f.getAsObject(null,N))}finally{f.free()}if(typeof $=="function")return $()},d.prototype.prepare=function(f,w){if(We(g),this.handleError(J(this.db,f,-1,g,0)),f=ye(g,"i32"),f===0)throw"Nothing to prepare";var x=new i(f,this);return w!=null&&x.bind(w),this.Ya[f]=x},d.prototype.iterateStatements=function(f){return new u(f,this)},d.prototype.export=function(){Object.values(this.Ya).forEach(function(w){w.free()}),Object.values(this.Ma).forEach(He),this.Ma={},this.handleError(U(this.db));var f=xa(this.filename);return this.handleError(I(this.filename,g)),this.db=ye(g,"i32"),zn(this.db),f},d.prototype.close=function(){this.db!==null&&(Object.values(this.Ya).forEach(function(f){f.free()}),Object.values(this.Ma).forEach(He),this.Ma={},this.handleError(U(this.db)),Tn("/"+this.filename),this.db=null)},d.prototype.handleError=function(f){if(f===0)return null;throw f=Na(this.db),Error(f)},d.prototype.getRowsModified=function(){return Q(this.db)},d.prototype.create_function=function(f,w){Object.prototype.hasOwnProperty.call(this.Ma,f)&&(He(this.Ma[f]),delete this.Ma[f]);var x=Ct(function($,N,O){N=t(N,O);try{var ce=w.apply(null,N)}catch(ie){xt($,ie,-1);return}e($,ce)},"viii");return this.Ma[f]=x,this.handleError(Rn(this.db,f,w.length,1,0,x,0,0,0)),this},d.prototype.create_aggregate=function(f,w){var x=w.init||function(){return null},$=w.finalize||function(ne){return ne},N=w.step;if(!N)throw"An aggregate function must have a step function in "+f;var O={};Object.hasOwnProperty.call(this.Ma,f)&&(He(this.Ma[f]),delete this.Ma[f]),w=f+"__finalize",Object.hasOwnProperty.call(this.Ma,w)&&(He(this.Ma[w]),delete this.Ma[w]);var ce=Ct(function(ne,de,ur){var Me=jn(ne,1);Object.hasOwnProperty.call(O,Me)||(O[Me]=x()),de=t(de,ur),de=[O[Me]].concat(de);try{O[Me]=N.apply(null,de)}catch(ti){delete O[Me],xt(ne,ti,-1)}},"viii"),ie=Ct(function(ne){var de=jn(ne,1);try{var ur=$(O[de])}catch(Me){delete O[de],xt(ne,Me,-1);return}e(ne,ur),delete O[de]},"vi");return this.Ma[f]=ce,this.Ma[w]=ie,this.handleError(Rn(this.db,f,N.length-1,1,0,0,ce,ie,0)),this},a.Database=d};var h=Object.assign({},a),b="./this.program",y="",D,S;if(m){var T=require("fs"),q=require("path");y=__dirname+"/",S=e=>(e=ut(e)?new URL(e):q.normalize(e),T.readFileSync(e)),D=e=>(e=ut(e)?new URL(e):q.normalize(e),new Promise((t,i)=>{T.readFile(e,void 0,(u,d)=>{u?i(u):t(d.buffer)})})),!a.thisProgram&&1<process.argv.length&&(b=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),typeof Be!="undefined"&&(Be.exports=a)}else(c||p)&&(p?y=self.location.href:typeof document!="undefined"&&document.currentScript&&(y=document.currentScript.src),y=y.startsWith("blob:")?"":y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1),p&&(S=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),D=e=>ut(e)?new Promise((t,i)=>{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=()=>{(u.status==200||u.status==0&&u.response)&&i(u.response),t(u.status)},u.onerror=t,u.send(null)}):fetch(e,{credentials:"same-origin"}).then(t=>t.ok?t.arrayBuffer():Promise.reject(Error(t.status+" : "+t.url))));var R=a.print||console.log.bind(console),C=a.printErr||console.error.bind(console);Object.assign(a,h),h=null,a.thisProgram&&(b=a.thisProgram);var H;a.wasmBinary&&(H=a.wasmBinary);var G,K=!1,F,B,he,A,z,ue,je;function lt(){var e=G.buffer;a.HEAP8=F=new Int8Array(e),a.HEAP16=he=new Int16Array(e),a.HEAPU8=B=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAP32=A=new Int32Array(e),a.HEAPU32=z=new Uint32Array(e),a.HEAPF32=ue=new Float32Array(e),a.HEAPF64=je=new Float64Array(e)}var tn=[],rn=[],nn=[];function da(){var e=a.preRun.shift();tn.unshift(e)}var _e=0,Wt=null,ze=null;function Se(e){var t;throw(t=a.onAbort)==null||t.call(a,e),e="Aborted("+e+")",C(e),K=!0,new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info.")}var on=e=>e.startsWith("data:application/octet-stream;base64,"),ut=e=>e.startsWith("file://"),Kt;function an(e){if(e==Kt&&H)return new Uint8Array(H);if(S)return S(e);throw"both async and sync fetching of the wasm failed"}function pa(e){return H?Promise.resolve().then(()=>an(e)):D(e).then(t=>new Uint8Array(t),()=>an(e))}function sn(e,t,i){return pa(e).then(u=>WebAssembly.instantiate(u,t)).then(i,u=>{C(`failed to asynchronously prepare wasm: ${u}`),Se(u)})}function ma(e,t){var i=Kt;H||typeof WebAssembly.instantiateStreaming!="function"||on(i)||ut(i)||m||typeof fetch!="function"?sn(i,e,t):fetch(i,{credentials:"same-origin"}).then(u=>WebAssembly.instantiateStreaming(u,e).then(t,function(d){return C(`wasm streaming compile failed: ${d}`),C("falling back to ArrayBuffer instantiation"),sn(i,e,t)}))}var k,j,Qt=e=>{for(;0<e.length;)e.shift()(a)};function ye(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":return F[e];case"i8":return F[e];case"i16":return he[e>>1];case"i32":return A[e>>2];case"i64":Se("to do getValue(i64) use WASM_BIGINT");case"float":return ue[e>>2];case"double":return je[e>>3];case"*":return z[e>>2];default:Se(`invalid type for getValue: ${t}`)}}function We(e){var t="i32";switch(t.endsWith("*")&&(t="*"),t){case"i1":F[e]=0;break;case"i8":F[e]=0;break;case"i16":he[e>>1]=0;break;case"i32":A[e>>2]=0;break;case"i64":Se("to do setValue(i64) use WASM_BIGINT");case"float":ue[e>>2]=0;break;case"double":je[e>>3]=0;break;case"*":z[e>>2]=0;break;default:Se(`invalid type for setValue: ${t}`)}}var ln=typeof TextDecoder!="undefined"?new TextDecoder:void 0,W=(e,t,i)=>{var u=t+i;for(i=t;e[i]&&!(i>=u);)++i;if(16<i-t&&e.buffer&&ln)return ln.decode(e.subarray(t,i));for(u="";t<i;){var d=e[t++];if(d&128){var g=e[t++]&63;if((d&224)==192)u+=String.fromCharCode((d&31)<<6|g);else{var v=e[t++]&63;d=(d&240)==224?(d&15)<<12|g<<6|v:(d&7)<<18|g<<12|v<<6|e[t++]&63,65536>d?u+=String.fromCharCode(d):(d-=65536,u+=String.fromCharCode(55296|d>>10,56320|d&1023))}}else u+=String.fromCharCode(d)}return u},Gt=(e,t)=>e?W(B,e,t):"",un=(e,t)=>{for(var i=0,u=e.length-1;0<=u;u--){var d=e[u];d==="."?e.splice(u,1):d===".."?(e.splice(u,1),i++):i&&(e.splice(u,1),i--)}if(t)for(;i;i--)e.unshift("..");return e},Ae=e=>{var t=e.charAt(0)==="/",i=e.substr(-1)==="/";return(e=un(e.split("/").filter(u=>!!u),!t).join("/"))||t||(e="."),e&&i&&(e+="/"),(t?"/":"")+e},ha=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],!e&&!t?".":(t&&(t=t.substr(0,t.length-1)),e+t)},ct=e=>{if(e==="/")return"/";e=Ae(e),e=e.replace(/\/$/,"");var t=e.lastIndexOf("/");return t===-1?e:e.substr(t+1)},fa=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);if(m)try{var e=require("crypto");if(e.randomFillSync)return i=>e.randomFillSync(i);var t=e.randomBytes;return i=>(i.set(t(i.byteLength)),i)}catch(i){}Se("initRandomDevice")},cn=e=>(cn=fa())(e),dt=(...e)=>{for(var t="",i=!1,u=e.length-1;-1<=u&&!i;u--){if(i=0<=u?e[u]:"/",typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!i)return"";t=i+"/"+t,i=i.charAt(0)==="/"}return t=un(t.split("/").filter(d=>!!d),!i).join("/"),(i?"/":"")+t||"."},Jt=[],Ke=e=>{for(var t=0,i=0;i<e.length;++i){var u=e.charCodeAt(i);127>=u?t++:2047>=u?t+=2:55296<=u&&57343>=u?(t+=4,++i):t+=3}return t},we=(e,t,i,u)=>{if(!(0<u))return 0;var d=i;u=i+u-1;for(var g=0;g<e.length;++g){var v=e.charCodeAt(g);if(55296<=v&&57343>=v){var I=e.charCodeAt(++g);v=65536+((v&1023)<<10)|I&1023}if(127>=v){if(i>=u)break;t[i++]=v}else{if(2047>=v){if(i+1>=u)break;t[i++]=192|v>>6}else{if(65535>=v){if(i+2>=u)break;t[i++]=224|v>>12}else{if(i+3>=u)break;t[i++]=240|v>>18,t[i++]=128|v>>12&63}t[i++]=128|v>>6&63}t[i++]=128|v&63}}return t[i]=0,i-d};function dn(e,t){var i=Array(Ke(e)+1);return e=we(e,i,0,i.length),t&&(i.length=e),i}var pn=[];function mn(e,t){pn[e]={input:[],output:[],Wa:t},er(e,ga)}var ga={open(e){var t=pn[e.node.rdev];if(!t)throw new E(43);e.tty=t,e.seekable=!1},close(e){e.tty.Wa.fsync(e.tty)},fsync(e){e.tty.Wa.fsync(e.tty)},read(e,t,i,u){if(!e.tty||!e.tty.Wa.rb)throw new E(60);for(var d=0,g=0;g<u;g++){try{var v=e.tty.Wa.rb(e.tty)}catch(I){throw new E(29)}if(v===void 0&&d===0)throw new E(6);if(v==null)break;d++,t[i+g]=v}return d&&(e.node.timestamp=Date.now()),d},write(e,t,i,u){if(!e.tty||!e.tty.Wa.ib)throw new E(60);try{for(var d=0;d<u;d++)e.tty.Wa.ib(e.tty,t[i+d])}catch(g){throw new E(29)}return u&&(e.node.timestamp=Date.now()),d}},ba={rb(){e:{if(!Jt.length){var e=null;if(m){var t=Buffer.alloc(256),i=0,u=process.stdin.fd;try{i=T.readSync(u,t,0,256)}catch(d){if(d.toString().includes("EOF"))i=0;else throw d}0<i&&(e=t.slice(0,i).toString("utf-8"))}else typeof window!="undefined"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`));if(!e){e=null;break e}Jt=dn(e,!0)}e=Jt.shift()}return e},ib(e,t){t===null||t===10?(R(W(e.output,0)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output&&0<e.output.length&&(R(W(e.output,0)),e.output=[])},Lb(){return{Gb:25856,Ib:5,Fb:191,Hb:35387,Eb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Mb(){return 0},Nb(){return[24,80]}},va={ib(e,t){t===null||t===10?(C(W(e.output,0)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output&&0<e.output.length&&(C(W(e.output,0)),e.output=[])}};function hn(e,t){var i=e.Ha?e.Ha.length:0;i>=t||(t=Math.max(t,i*(1048576>i?2:1.125)>>>0),i!=0&&(t=Math.max(t,256)),i=e.Ha,e.Ha=new Uint8Array(t),0<e.La&&e.Ha.set(i.subarray(0,e.La),0))}var P={Pa:null,Qa(){return P.createNode(null,"/",16895,0)},createNode(e,t,i,u){if((i&61440)===24576||(i&61440)===4096)throw new E(63);return P.Pa||(P.Pa={dir:{node:{Oa:P.Fa.Oa,Na:P.Fa.Na,lookup:P.Fa.lookup,$a:P.Fa.$a,rename:P.Fa.rename,unlink:P.Fa.unlink,rmdir:P.Fa.rmdir,readdir:P.Fa.readdir,symlink:P.Fa.symlink},stream:{Sa:P.Ga.Sa}},file:{node:{Oa:P.Fa.Oa,Na:P.Fa.Na},stream:{Sa:P.Ga.Sa,read:P.Ga.read,write:P.Ga.write,kb:P.Ga.kb,ab:P.Ga.ab,bb:P.Ga.bb}},link:{node:{Oa:P.Fa.Oa,Na:P.Fa.Na,readlink:P.Fa.readlink},stream:{}},ob:{node:{Oa:P.Fa.Oa,Na:P.Fa.Na},stream:Sa}}),i=yn(e,t,i,u),re(i.mode)?(i.Fa=P.Pa.dir.node,i.Ga=P.Pa.dir.stream,i.Ha={}):(i.mode&61440)===32768?(i.Fa=P.Pa.file.node,i.Ga=P.Pa.file.stream,i.La=0,i.Ha=null):(i.mode&61440)===40960?(i.Fa=P.Pa.link.node,i.Ga=P.Pa.link.stream):(i.mode&61440)===8192&&(i.Fa=P.Pa.ob.node,i.Ga=P.Pa.ob.stream),i.timestamp=Date.now(),e&&(e.Ha[t]=i,e.timestamp=i.timestamp),i},Kb(e){return e.Ha?e.Ha.subarray?e.Ha.subarray(0,e.La):new Uint8Array(e.Ha):new Uint8Array(0)},Fa:{Oa(e){var t={};return t.dev=(e.mode&61440)===8192?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,re(e.mode)?t.size=4096:(e.mode&61440)===32768?t.size=e.La:(e.mode&61440)===40960?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.yb=4096,t.blocks=Math.ceil(t.size/t.yb),t},Na(e,t){if(t.mode!==void 0&&(e.mode=t.mode),t.timestamp!==void 0&&(e.timestamp=t.timestamp),t.size!==void 0&&(t=t.size,e.La!=t))if(t==0)e.Ha=null,e.La=0;else{var i=e.Ha;e.Ha=new Uint8Array(t),i&&e.Ha.set(i.subarray(0,Math.min(t,e.La))),e.La=t}},lookup(){throw Xt[44]},$a(e,t,i,u){return P.createNode(e,t,i,u)},rename(e,t,i){if(re(e.mode)){try{var u=ke(t,i)}catch(g){}if(u)for(var d in u.Ha)throw new E(55)}delete e.parent.Ha[e.name],e.parent.timestamp=Date.now(),e.name=i,t.Ha[i]=e,t.timestamp=e.parent.timestamp},unlink(e,t){delete e.Ha[t],e.timestamp=Date.now()},rmdir(e,t){var i=ke(e,t),u;for(u in i.Ha)throw new E(55);delete e.Ha[t],e.timestamp=Date.now()},readdir(e){var t=[".",".."],i;for(i of Object.keys(e.Ha))t.push(i);return t},symlink(e,t,i){return e=P.createNode(e,t,41471,0),e.link=i,e},readlink(e){if((e.mode&61440)!==40960)throw new E(28);return e.link}},Ga:{read(e,t,i,u,d){var g=e.node.Ha;if(d>=e.node.La)return 0;if(e=Math.min(e.node.La-d,u),8<e&&g.subarray)t.set(g.subarray(d,d+e),i);else for(u=0;u<e;u++)t[i+u]=g[d+u];return e},write(e,t,i,u,d,g){if(t.buffer===F.buffer&&(g=!1),!u)return 0;if(e=e.node,e.timestamp=Date.now(),t.subarray&&(!e.Ha||e.Ha.subarray)){if(g)return e.Ha=t.subarray(i,i+u),e.La=u;if(e.La===0&&d===0)return e.Ha=t.slice(i,i+u),e.La=u;if(d+u<=e.La)return e.Ha.set(t.subarray(i,i+u),d),u}if(hn(e,d+u),e.Ha.subarray&&t.subarray)e.Ha.set(t.subarray(i,i+u),d);else for(g=0;g<u;g++)e.Ha[d+g]=t[i+g];return e.La=Math.max(e.La,d+u),u},Sa(e,t,i){if(i===1?t+=e.position:i===2&&(e.node.mode&61440)===32768&&(t+=e.node.La),0>t)throw new E(28);return t},kb(e,t,i){hn(e.node,t+i),e.node.La=Math.max(e.node.La,t+i)},ab(e,t,i,u,d){if((e.node.mode&61440)!==32768)throw new E(43);if(e=e.node.Ha,d&2||e.buffer!==F.buffer){if((0<i||i+t<e.length)&&(e.subarray?e=e.subarray(i,i+t):e=Array.prototype.slice.call(e,i,i+t)),i=!0,t=65536*Math.ceil(t/65536),(d=Ln(65536,t))?(B.fill(0,d,d+t),t=d):t=0,!t)throw new E(48);F.set(e,t)}else i=!1,t=e.byteOffset;return{Cb:t,tb:i}},bb(e,t,i,u){return P.Ga.write(e,t,0,u,i,!1),0}}},fn=(e,t)=>{var i=0;return e&&(i|=365),t&&(i|=146),i},Yt=null,gn={},Qe=[],ya=1,xe=null,bn=!0,E=class{constructor(e){this.name="ErrnoError",this.Ja=e}},Xt={},wa=class{constructor(){this.Za={},this.node=null}get flags(){return this.Za.flags}set flags(e){this.Za.flags=e}get position(){return this.Za.position}set position(e){this.Za.position=e}},Ca=class{constructor(e,t,i,u){e||(e=this),this.parent=e,this.Qa=e.Qa,this.Ua=null,this.id=ya++,this.name=t,this.mode=i,this.Fa={},this.Ga={},this.rdev=u}get read(){return(this.mode&365)===365}set read(e){e?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(e){e?this.mode|=146:this.mode&=-147}};function te(e,t={}){if(e=dt(e),!e)return{path:"",node:null};if(t=Object.assign({pb:!0,jb:0},t),8<t.jb)throw new E(32);e=e.split("/").filter(v=>!!v);for(var i=Yt,u="/",d=0;d<e.length;d++){var g=d===e.length-1;if(g&&t.parent)break;if(i=ke(i,e[d]),u=Ae(u+"/"+e[d]),i.Ua&&(!g||g&&t.pb)&&(i=i.Ua.root),!g||t.Ra){for(g=0;(i.mode&61440)===40960;)if(i=_n(u),u=dt(ha(u),i),i=te(u,{jb:t.jb+1}).node,40<g++)throw new E(32)}}return{path:u,node:i}}function pt(e){for(var t;;){if(e===e.parent)return e=e.Qa.sb,t?e[e.length-1]!=="/"?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function Zt(e,t){for(var i=0,u=0;u<t.length;u++)i=(i<<5)-i+t.charCodeAt(u)|0;return(e+i>>>0)%xe.length}function vn(e){var t=Zt(e.parent.id,e.name);if(xe[t]===e)xe[t]=e.Va;else for(t=xe[t];t;){if(t.Va===e){t.Va=e.Va;break}t=t.Va}}function ke(e,t){var i=re(e.mode)?(i=qe(e,"x"))?i:e.Fa.lookup?0:2:54;if(i)throw new E(i);for(i=xe[Zt(e.id,t)];i;i=i.Va){var u=i.name;if(i.parent.id===e.id&&u===t)return i}return e.Fa.lookup(e,t)}function yn(e,t,i,u){return e=new Ca(e,t,i,u),t=Zt(e.parent.id,e.name),e.Va=xe[t],xe[t]=e}function re(e){return(e&61440)===16384}function wn(e){var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t}function qe(e,t){if(bn)return 0;if(!t.includes("r")||e.mode&292){if(t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73))return 2}else return 2;return 0}function Cn(e,t){try{return ke(e,t),20}catch(i){}return qe(e,"wx")}function En(e,t,i){try{var u=ke(e,t)}catch(d){return d.Ja}if(e=qe(e,"wx"))return e;if(i){if(!re(u.mode))return 54;if(u===u.parent||pt(u)==="/")return 10}else if(re(u.mode))return 31;return 0}function Z(e){if(e=Qe[e],!e)throw new E(8);return e}function Sn(e,t=-1){if(e=Object.assign(new wa,e),t==-1)e:{for(t=0;4096>=t;t++)if(!Qe[t])break e;throw new E(33)}return e.fd=t,Qe[t]=e}function Ea(e,t=-1){var i,u;return e=Sn(e,t),(u=(i=e.Ga)==null?void 0:i.Jb)==null||u.call(i,e),e}var Sa={open(e){var t,i;e.Ga=gn[e.node.rdev].Ga,(i=(t=e.Ga).open)==null||i.call(t,e)},Sa(){throw new E(70)}};function er(e,t){gn[e]={Ga:t}}function xn(e,t){var i=t==="/";if(i&&Yt)throw new E(10);if(!i&&t){var u=te(t,{pb:!1});if(t=u.path,u=u.node,u.Ua)throw new E(10);if(!re(u.mode))throw new E(54)}t={type:e,Ob:{},sb:t,Bb:[]},e=e.Qa(t),e.Qa=t,t.root=e,i?Yt=e:u&&(u.Ua=t,u.Qa&&u.Qa.Bb.push(t))}function mt(e,t,i){var u=te(e,{parent:!0}).node;if(e=ct(e),!e||e==="."||e==="..")throw new E(28);var d=Cn(u,e);if(d)throw new E(d);if(!u.Fa.$a)throw new E(63);return u.Fa.$a(u,e,t,i)}function fe(e,t){return mt(e,(t!==void 0?t:511)&1023|16384,0)}function ht(e,t,i){typeof i=="undefined"&&(i=t,t=438),mt(e,t|8192,i)}function tr(e,t){if(!dt(e))throw new E(44);var i=te(t,{parent:!0}).node;if(!i)throw new E(44);t=ct(t);var u=Cn(i,t);if(u)throw new E(u);if(!i.Fa.symlink)throw new E(63);i.Fa.symlink(i,t,e)}function Dn(e){var t=te(e,{parent:!0}).node;e=ct(e);var i=ke(t,e),u=En(t,e,!0);if(u)throw new E(u);if(!t.Fa.rmdir)throw new E(63);if(i.Ua)throw new E(10);t.Fa.rmdir(t,e),vn(i)}function Tn(e){var t=te(e,{parent:!0}).node;if(!t)throw new E(44);e=ct(e);var i=ke(t,e),u=En(t,e,!1);if(u)throw new E(u);if(!t.Fa.unlink)throw new E(63);if(i.Ua)throw new E(10);t.Fa.unlink(t,e),vn(i)}function _n(e){if(e=te(e).node,!e)throw new E(44);if(!e.Fa.readlink)throw new E(28);return dt(pt(e.parent),e.Fa.readlink(e))}function Ge(e,t){if(e=te(e,{Ra:!t}).node,!e)throw new E(44);if(!e.Fa.Oa)throw new E(63);return e.Fa.Oa(e)}function An(e){return Ge(e,!0)}function ft(e,t){if(e=typeof e=="string"?te(e,{Ra:!0}).node:e,!e.Fa.Na)throw new E(63);e.Fa.Na(e,{mode:t&4095|e.mode&-4096,timestamp:Date.now()})}function kn(e,t){if(0>t)throw new E(28);if(e=typeof e=="string"?te(e,{Ra:!0}).node:e,!e.Fa.Na)throw new E(63);if(re(e.mode))throw new E(31);if((e.mode&61440)!==32768)throw new E(28);var i=qe(e,"w");if(i)throw new E(i);e.Fa.Na(e,{size:t,timestamp:Date.now()})}function Fe(e,t,i){if(e==="")throw new E(44);if(typeof t=="string"){var u={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(typeof u=="undefined")throw Error(`Unknown file open mode: ${t}`);t=u}if(i=t&64?(typeof i=="undefined"?438:i)&4095|32768:0,typeof e=="object")var d=e;else{e=Ae(e);try{d=te(e,{Ra:!(t&131072)}).node}catch(g){}}if(u=!1,t&64)if(d){if(t&128)throw new E(20)}else d=mt(e,i,0),u=!0;if(!d)throw new E(44);if((d.mode&61440)===8192&&(t&=-513),t&65536&&!re(d.mode))throw new E(54);if(!u&&(i=d?(d.mode&61440)===40960?32:re(d.mode)&&(wn(t)!=="r"||t&512)?31:qe(d,wn(t)):44))throw new E(i);return t&512&&!u&&kn(d,0),t&=-131713,d=Sn({node:d,path:pt(d),flags:t,seekable:!0,position:0,Ga:d.Ga,Db:[],error:!1}),d.Ga.open&&d.Ga.open(d),!a.logReadFiles||t&1||(nr||(nr={}),e in nr||(nr[e]=1)),d}function rr(e){if(e.fd===null)throw new E(8);e.gb&&(e.gb=null);try{e.Ga.close&&e.Ga.close(e)}catch(t){throw t}finally{Qe[e.fd]=null}e.fd=null}function In(e,t,i){if(e.fd===null)throw new E(8);if(!e.seekable||!e.Ga.Sa)throw new E(70);if(i!=0&&i!=1&&i!=2)throw new E(28);e.position=e.Ga.Sa(e,t,i),e.Db=[]}function $n(e,t,i,u,d){if(0>u||0>d)throw new E(28);if(e.fd===null)throw new E(8);if((e.flags&2097155)===1)throw new E(8);if(re(e.node.mode))throw new E(31);if(!e.Ga.read)throw new E(28);var g=typeof d!="undefined";if(!g)d=e.position;else if(!e.seekable)throw new E(70);return t=e.Ga.read(e,t,i,u,d),g||(e.position+=t),t}function Mn(e,t,i,u,d){if(0>u||0>d)throw new E(28);if(e.fd===null)throw new E(8);if(!(e.flags&2097155))throw new E(8);if(re(e.node.mode))throw new E(31);if(!e.Ga.write)throw new E(28);e.seekable&&e.flags&1024&&In(e,0,2);var g=typeof d!="undefined";if(!g)d=e.position;else if(!e.seekable)throw new E(70);return t=e.Ga.write(e,t,i,u,d,void 0),g||(e.position+=t),t}function xa(e){var t="binary";if(t!=="utf8"&&t!=="binary")throw Error(`Invalid encoding type "${t}"`);var i,u=Fe(e,u||0);e=Ge(e).size;var d=new Uint8Array(e);return $n(u,d,0,e,0),t==="utf8"?i=W(d,0):t==="binary"&&(i=d),rr(u),i}var Bn;function Je(e,t,i){e=Ae("/dev/"+e);var u=fn(!!t,!!i);Pn||(Pn=64);var d=Pn++<<8|0;er(d,{open(g){g.seekable=!1},close(){var g;(g=i==null?void 0:i.buffer)!=null&&g.length&&i(10)},read(g,v,I,U){for(var M=0,Q=0;Q<U;Q++){try{var J=t()}catch(Fn){throw new E(29)}if(J===void 0&&M===0)throw new E(6);if(J==null)break;M++,v[I+Q]=J}return M&&(g.node.timestamp=Date.now()),M},write(g,v,I,U){for(var M=0;M<U;M++)try{i(v[I+M])}catch(Q){throw new E(29)}return U&&(g.node.timestamp=Date.now()),M}}),ht(e,u,d)}var Pn,V={},nr;function Ie(e,t,i){if(t.charAt(0)==="/")return t;if(e=e===-100?"/":Z(e).path,t.length==0){if(!i)throw new E(44);return e}return Ae(e+"/"+t)}function gt(e,t,i){e=e(t),A[i>>2]=e.dev,A[i+4>>2]=e.mode,z[i+8>>2]=e.nlink,A[i+12>>2]=e.uid,A[i+16>>2]=e.gid,A[i+20>>2]=e.rdev,j=[e.size>>>0,(k=e.size,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[i+24>>2]=j[0],A[i+28>>2]=j[1],A[i+32>>2]=4096,A[i+36>>2]=e.blocks,t=e.atime.getTime();var u=e.mtime.getTime(),d=e.ctime.getTime();return j=[Math.floor(t/1e3)>>>0,(k=Math.floor(t/1e3),1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[i+40>>2]=j[0],A[i+44>>2]=j[1],z[i+48>>2]=t%1e3*1e3,j=[Math.floor(u/1e3)>>>0,(k=Math.floor(u/1e3),1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[i+56>>2]=j[0],A[i+60>>2]=j[1],z[i+64>>2]=u%1e3*1e3,j=[Math.floor(d/1e3)>>>0,(k=Math.floor(d/1e3),1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[i+72>>2]=j[0],A[i+76>>2]=j[1],z[i+80>>2]=d%1e3*1e3,j=[e.ino>>>0,(k=e.ino,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[i+88>>2]=j[0],A[i+92>>2]=j[1],0}var bt=void 0;function vt(){var e=A[+bt>>2];return bt+=4,e}var Ye=(e,t)=>t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN,Da=[0,31,60,91,121,152,182,213,244,274,305,335],Ta=[0,31,59,90,120,151,181,212,243,273,304,334],or={},Nn=()=>{if(!ar){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:b||"./this.program"},t;for(t in or)or[t]===void 0?delete e[t]:e[t]=or[t];var i=[];for(t in e)i.push(`${t}=${e[t]}`);ar=i}return ar},ar,ir=e=>{var t=Ke(e)+1,i=De(t);return we(e,B,i,t),i},_a=(e,t,i,u)=>{var d={string:M=>{var Q=0;return M!=null&&M!==0&&(Q=ir(M)),Q},array:M=>{var Q=De(M.length);return F.set(M,Q),Q}};e=a["_"+e];var g=[],v=0;if(u)for(var I=0;I<u.length;I++){var U=d[i[I]];U?(v===0&&(v=Ze()),g[I]=U(u[I])):g[I]=u[I]}return i=e(...g),i=function(M){return v!==0&&Xe(v),t==="string"?M?W(B,M):"":t==="boolean"?!!M:M}(i)},yt=0,wt=(e,t)=>(t=t==1?De(e.length):lr(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),B.set(e,t),t),$e,sr=[],Ce,He=e=>{$e.delete(Ce.get(e)),Ce.set(e,null),sr.push(e)},Ct=(e,t)=>{if(!$e){$e=new WeakMap;var i=Ce.length;if($e)for(var u=0;u<0+i;u++){var d=Ce.get(u);d&&$e.set(d,u)}}if(i=$e.get(e)||0)return i;if(sr.length)i=sr.pop();else{try{Ce.grow(1)}catch(I){throw I instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":I}i=Ce.length-1}try{Ce.set(i,e)}catch(I){if(!(I instanceof TypeError))throw I;if(typeof WebAssembly.Function=="function"){u=WebAssembly.Function,d={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var g={parameters:[],results:t[0]=="v"?[]:[d[t[0]]]},v=1;v<t.length;++v)g.parameters.push(d[t[v]]);t=new u(g,e)}else{for(u=[1],d=t.slice(0,1),t=t.slice(1),g={i:127,p:127,j:126,f:125,d:124,e:111},u.push(96),v=t.length,128>v?u.push(v):u.push(v%128|128,v>>7),v=0;v<t.length;++v)u.push(g[t[v]]);d=="v"?u.push(0):u.push(1,g[d]),t=[0,97,115,109,1,0,0,0,1],d=u.length,128>d?t.push(d):t.push(d%128|128,d>>7),t.push(...u),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}Ce.set(i,t)}return $e.set(e,i),i};[44].forEach(e=>{Xt[e]=new E(e),Xt[e].stack="<generic error, no stack>"}),xe=Array(4096),xn(P,"/"),fe("/tmp"),fe("/home"),fe("/home/web_user"),function(){fe("/dev"),er(259,{read:()=>0,write:(u,d,g,v)=>v}),ht("/dev/null",259),mn(1280,ba),mn(1536,va),ht("/dev/tty",1280),ht("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,i=()=>(t===0&&(t=cn(e).byteLength),e[--t]);Je("random",i),Je("urandom",i),fe("/dev/shm"),fe("/dev/shm/tmp")}(),function(){fe("/proc");var e=fe("/proc/self");fe("/proc/self/fd"),xn({Qa(){var t=yn(e,"fd",16895,73);return t.Fa={lookup(i,u){var d=Z(+u);return i={parent:null,Qa:{sb:"fake"},Fa:{readlink:()=>d.path}},i.parent=i}},t}},"/proc/self/fd")}();var Aa={a:(e,t,i,u)=>{Se(`Assertion failed: ${e?W(B,e):""}, at: `+[t?t?W(B,t):"":"unknown filename",i,u?u?W(B,u):"":"unknown function"])},h:function(e,t){try{return e=e?W(B,e):"",ft(e,t),0}catch(i){if(typeof V=="undefined"||i.name!=="ErrnoError")throw i;return-i.Ja}},H:function(e,t,i){try{if(t=t?W(B,t):"",t=Ie(e,t),i&-8)return-28;var u=te(t,{Ra:!0}).node;return u?(e="",i&4&&(e+="r"),i&2&&(e+="w"),i&1&&(e+="x"),e&&qe(u,e)?-2:0):-44}catch(d){if(typeof V=="undefined"||d.name!=="ErrnoError")throw d;return-d.Ja}},i:function(e,t){try{var i=Z(e);return ft(i.node,t),0}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return-u.Ja}},g:function(e){try{var t=Z(e).node,i=typeof t=="string"?te(t,{Ra:!0}).node:t;if(!i.Fa.Na)throw new E(63);return i.Fa.Na(i,{timestamp:Date.now()}),0}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return-u.Ja}},b:function(e,t,i){bt=i;try{var u=Z(e);switch(t){case 0:var d=vt();if(0>d)break;for(;Qe[d];)d++;return Ea(u,d).fd;case 1:case 2:return 0;case 3:return u.flags;case 4:return d=vt(),u.flags|=d,0;case 12:return d=vt(),he[d+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(g){if(typeof V=="undefined"||g.name!=="ErrnoError")throw g;return-g.Ja}},f:function(e,t){try{var i=Z(e);return gt(Ge,i.path,t)}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return-u.Ja}},n:function(e,t,i){t=Ye(t,i);try{if(isNaN(t))return 61;var u=Z(e);if(!(u.flags&2097155))throw new E(28);return kn(u.node,t),0}catch(d){if(typeof V=="undefined"||d.name!=="ErrnoError")throw d;return-d.Ja}},C:function(e,t){try{if(t===0)return-28;var i=Ke("/")+1;return t<i?-68:(we("/",B,e,t),i)}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return-u.Ja}},F:function(e,t){try{return e=e?W(B,e):"",gt(An,e,t)}catch(i){if(typeof V=="undefined"||i.name!=="ErrnoError")throw i;return-i.Ja}},z:function(e,t,i){try{return t=t?W(B,t):"",t=Ie(e,t),t=Ae(t),t[t.length-1]==="/"&&(t=t.substr(0,t.length-1)),fe(t,i),0}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return-u.Ja}},E:function(e,t,i,u){try{t=t?W(B,t):"";var d=u&256;return t=Ie(e,t,u&4096),gt(d?An:Ge,t,i)}catch(g){if(typeof V=="undefined"||g.name!=="ErrnoError")throw g;return-g.Ja}},x:function(e,t,i,u){bt=u;try{t=t?W(B,t):"",t=Ie(e,t);var d=u?vt():0;return Fe(t,i,d).fd}catch(g){if(typeof V=="undefined"||g.name!=="ErrnoError")throw g;return-g.Ja}},v:function(e,t,i,u){try{if(t=t?W(B,t):"",t=Ie(e,t),0>=u)return-28;var d=_n(t),g=Math.min(u,Ke(d)),v=F[i+g];return we(d,B,i,u+1),F[i+g]=v,g}catch(I){if(typeof V=="undefined"||I.name!=="ErrnoError")throw I;return-I.Ja}},u:function(e){try{return e=e?W(B,e):"",Dn(e),0}catch(t){if(typeof V=="undefined"||t.name!=="ErrnoError")throw t;return-t.Ja}},G:function(e,t){try{return e=e?W(B,e):"",gt(Ge,e,t)}catch(i){if(typeof V=="undefined"||i.name!=="ErrnoError")throw i;return-i.Ja}},r:function(e,t,i){try{return t=t?W(B,t):"",t=Ie(e,t),i===0?Tn(t):i===512?Dn(t):Se("Invalid flags passed to unlinkat"),0}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return-u.Ja}},q:function(e,t,i){try{if(t=t?W(B,t):"",t=Ie(e,t,!0),i){var u=z[i>>2]+4294967296*A[i+4>>2],d=A[i+8>>2];g=1e3*u+d/1e6,i+=16,u=z[i>>2]+4294967296*A[i+4>>2],d=A[i+8>>2],v=1e3*u+d/1e6}else var g=Date.now(),v=g;e=g;var I=te(t,{Ra:!0}).node;return I.Fa.Na(I,{timestamp:Math.max(e,v)}),0}catch(U){if(typeof V=="undefined"||U.name!=="ErrnoError")throw U;return-U.Ja}},l:function(e,t,i){e=new Date(1e3*Ye(e,t)),A[i>>2]=e.getSeconds(),A[i+4>>2]=e.getMinutes(),A[i+8>>2]=e.getHours(),A[i+12>>2]=e.getDate(),A[i+16>>2]=e.getMonth(),A[i+20>>2]=e.getFullYear()-1900,A[i+24>>2]=e.getDay(),t=e.getFullYear(),A[i+28>>2]=(t%4!==0||t%100===0&&t%400!==0?Ta:Da)[e.getMonth()]+e.getDate()-1|0,A[i+36>>2]=-(60*e.getTimezoneOffset()),t=new Date(e.getFullYear(),6,1).getTimezoneOffset();var u=new Date(e.getFullYear(),0,1).getTimezoneOffset();A[i+32>>2]=(t!=u&&e.getTimezoneOffset()==Math.min(u,t))|0},j:function(e,t,i,u,d,g,v,I){d=Ye(d,g);try{if(isNaN(d))return 61;var U=Z(u);if(t&2&&!(i&2)&&(U.flags&2097155)!==2)throw new E(2);if((U.flags&2097155)===1)throw new E(2);if(!U.Ga.ab)throw new E(43);var M=U.Ga.ab(U,e,d,t,i),Q=M.Cb;return A[v>>2]=M.tb,z[I>>2]=Q,0}catch(J){if(typeof V=="undefined"||J.name!=="ErrnoError")throw J;return-J.Ja}},k:function(e,t,i,u,d,g,v){g=Ye(g,v);try{var I=Z(d);if(i&2){if((I.node.mode&61440)!==32768)throw new E(43);if(!(u&2)){var U=B.slice(e,e+t);I.Ga.bb&&I.Ga.bb(I,U,g,t,u)}}}catch(M){if(typeof V=="undefined"||M.name!=="ErrnoError")throw M;return-M.Ja}},y:(e,t,i,u)=>{var d=new Date().getFullYear(),g=new Date(d,0,1).getTimezoneOffset();d=new Date(d,6,1).getTimezoneOffset(),z[e>>2]=60*Math.max(g,d),A[t>>2]=Number(g!=d),t=v=>{var I=Math.abs(v);return`UTC${0<=v?"-":"+"}${String(Math.floor(I/60)).padStart(2,"0")}${String(I%60).padStart(2,"0")}`},e=t(g),t=t(d),d<g?(we(e,B,i,17),we(t,B,u,17)):(we(e,B,u,17),we(t,B,i,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:e=>{var t=B.length;if(e>>>=0,2147483648<e)return!1;for(var i=1;4>=i;i*=2){var u=t*(1+.2/i);u=Math.min(u,e+100663296);var d=Math;u=Math.max(e,u);e:{d=(d.min.call(d,2147483648,u+(65536-u%65536)%65536)-G.buffer.byteLength+65535)/65536;try{G.grow(d),lt();var g=1;break e}catch(v){}g=void 0}if(g)return!0}return!1},A:(e,t)=>{var i=0;return Nn().forEach((u,d)=>{var g=t+i;for(d=z[e+4*d>>2]=g,g=0;g<u.length;++g)F[d++]=u.charCodeAt(g);F[d]=0,i+=u.length+1}),0},B:(e,t)=>{var i=Nn();z[e>>2]=i.length;var u=0;return i.forEach(d=>u+=d.length+1),z[t>>2]=u,0},e:function(e){try{var t=Z(e);return rr(t),0}catch(i){if(typeof V=="undefined"||i.name!=="ErrnoError")throw i;return i.Ja}},p:function(e,t){try{var i=Z(e);return F[t]=i.tty?2:re(i.mode)?3:(i.mode&61440)===40960?7:4,he[t+2>>1]=0,j=[0,(k=0,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[t+8>>2]=j[0],A[t+12>>2]=j[1],j=[0,(k=0,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[t+16>>2]=j[0],A[t+20>>2]=j[1],0}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return u.Ja}},w:function(e,t,i,u){try{e:{var d=Z(e);e=t;for(var g,v=t=0;v<i;v++){var I=z[e>>2],U=z[e+4>>2];e+=8;var M=$n(d,F,I,U,g);if(0>M){var Q=-1;break e}if(t+=M,M<U)break;typeof g!="undefined"&&(g+=M)}Q=t}return z[u>>2]=Q,0}catch(J){if(typeof V=="undefined"||J.name!=="ErrnoError")throw J;return J.Ja}},m:function(e,t,i,u,d){t=Ye(t,i);try{if(isNaN(t))return 61;var g=Z(e);return In(g,t,u),j=[g.position>>>0,(k=g.position,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],A[d>>2]=j[0],A[d+4>>2]=j[1],g.gb&&t===0&&u===0&&(g.gb=null),0}catch(v){if(typeof V=="undefined"||v.name!=="ErrnoError")throw v;return v.Ja}},D:function(e){var i;try{var t=Z(e);return(i=t.Ga)!=null&&i.fsync?t.Ga.fsync(t):0}catch(u){if(typeof V=="undefined"||u.name!=="ErrnoError")throw u;return u.Ja}},t:function(e,t,i,u){try{e:{var d=Z(e);e=t;for(var g,v=t=0;v<i;v++){var I=z[e>>2],U=z[e+4>>2];e+=8;var M=Mn(d,F,I,U,g);if(0>M){var Q=-1;break e}t+=M,typeof g!="undefined"&&(g+=M)}Q=t}return z[u>>2]=Q,0}catch(J){if(typeof V=="undefined"||J.name!=="ErrnoError")throw J;return J.Ja}}},_=function(){var i;function e(u){var d;return _=u.exports,G=_.I,lt(),Ce=_.K,rn.unshift(_.J),_e--,(d=a.monitorRunDependencies)==null||d.call(a,_e),_e==0&&(Wt!==null&&(clearInterval(Wt),Wt=null),ze&&(u=ze,ze=null,u())),_}var t={a:Aa};if(_e++,(i=a.monitorRunDependencies)==null||i.call(a,_e),a.instantiateWasm)try{return a.instantiateWasm(t,e)}catch(u){return C(`Module.instantiateWasm callback failed with error: ${u}`),!1}return Kt||(Kt=on("sql-wasm.wasm")?"sql-wasm.wasm":a.locateFile?a.locateFile("sql-wasm.wasm",y):y+"sql-wasm.wasm"),ma(t,function(u){e(u.instance)}),{}}();a._sqlite3_free=e=>(a._sqlite3_free=_.L)(e),a._sqlite3_value_text=e=>(a._sqlite3_value_text=_.M)(e),a._sqlite3_prepare_v2=(e,t,i,u,d)=>(a._sqlite3_prepare_v2=_.N)(e,t,i,u,d),a._sqlite3_step=e=>(a._sqlite3_step=_.O)(e),a._sqlite3_reset=e=>(a._sqlite3_reset=_.P)(e),a._sqlite3_exec=(e,t,i,u,d)=>(a._sqlite3_exec=_.Q)(e,t,i,u,d),a._sqlite3_finalize=e=>(a._sqlite3_finalize=_.R)(e),a._sqlite3_column_name=(e,t)=>(a._sqlite3_column_name=_.S)(e,t),a._sqlite3_column_text=(e,t)=>(a._sqlite3_column_text=_.T)(e,t),a._sqlite3_column_type=(e,t)=>(a._sqlite3_column_type=_.U)(e,t),a._sqlite3_errmsg=e=>(a._sqlite3_errmsg=_.V)(e),a._sqlite3_clear_bindings=e=>(a._sqlite3_clear_bindings=_.W)(e),a._sqlite3_value_blob=e=>(a._sqlite3_value_blob=_.X)(e),a._sqlite3_value_bytes=e=>(a._sqlite3_value_bytes=_.Y)(e),a._sqlite3_value_double=e=>(a._sqlite3_value_double=_.Z)(e),a._sqlite3_value_int=e=>(a._sqlite3_value_int=_._)(e),a._sqlite3_value_type=e=>(a._sqlite3_value_type=_.$)(e),a._sqlite3_result_blob=(e,t,i,u)=>(a._sqlite3_result_blob=_.aa)(e,t,i,u),a._sqlite3_result_double=(e,t)=>(a._sqlite3_result_double=_.ba)(e,t),a._sqlite3_result_error=(e,t,i)=>(a._sqlite3_result_error=_.ca)(e,t,i),a._sqlite3_result_int=(e,t)=>(a._sqlite3_result_int=_.da)(e,t),a._sqlite3_result_int64=(e,t,i)=>(a._sqlite3_result_int64=_.ea)(e,t,i),a._sqlite3_result_null=e=>(a._sqlite3_result_null=_.fa)(e),a._sqlite3_result_text=(e,t,i,u)=>(a._sqlite3_result_text=_.ga)(e,t,i,u),a._sqlite3_aggregate_context=(e,t)=>(a._sqlite3_aggregate_context=_.ha)(e,t),a._sqlite3_column_count=e=>(a._sqlite3_column_count=_.ia)(e),a._sqlite3_data_count=e=>(a._sqlite3_data_count=_.ja)(e),a._sqlite3_column_blob=(e,t)=>(a._sqlite3_column_blob=_.ka)(e,t),a._sqlite3_column_bytes=(e,t)=>(a._sqlite3_column_bytes=_.la)(e,t),a._sqlite3_column_double=(e,t)=>(a._sqlite3_column_double=_.ma)(e,t),a._sqlite3_bind_blob=(e,t,i,u,d)=>(a._sqlite3_bind_blob=_.na)(e,t,i,u,d),a._sqlite3_bind_double=(e,t,i)=>(a._sqlite3_bind_double=_.oa)(e,t,i),a._sqlite3_bind_int=(e,t,i)=>(a._sqlite3_bind_int=_.pa)(e,t,i),a._sqlite3_bind_text=(e,t,i,u,d)=>(a._sqlite3_bind_text=_.qa)(e,t,i,u,d),a._sqlite3_bind_parameter_index=(e,t)=>(a._sqlite3_bind_parameter_index=_.ra)(e,t),a._sqlite3_sql=e=>(a._sqlite3_sql=_.sa)(e),a._sqlite3_normalized_sql=e=>(a._sqlite3_normalized_sql=_.ta)(e),a._sqlite3_changes=e=>(a._sqlite3_changes=_.ua)(e),a._sqlite3_close_v2=e=>(a._sqlite3_close_v2=_.va)(e),a._sqlite3_create_function_v2=(e,t,i,u,d,g,v,I,U)=>(a._sqlite3_create_function_v2=_.wa)(e,t,i,u,d,g,v,I,U),a._sqlite3_open=(e,t)=>(a._sqlite3_open=_.xa)(e,t);var lr=a._malloc=e=>(lr=a._malloc=_.ya)(e),Et=a._free=e=>(Et=a._free=_.za)(e);a._RegisterExtensionFunctions=e=>(a._RegisterExtensionFunctions=_.Aa)(e);var Ln=(e,t)=>(Ln=_.Ba)(e,t),Xe=e=>(Xe=_.Ca)(e),De=e=>(De=_.Da)(e),Ze=()=>(Ze=_.Ea)();a.stackSave=()=>Ze(),a.stackRestore=e=>Xe(e),a.stackAlloc=e=>De(e),a.cwrap=(e,t,i,u)=>{var d=!i||i.every(g=>g==="number"||g==="boolean");return t!=="string"&&d&&!u?a["_"+e]:(...g)=>_a(e,t,i,g)},a.addFunction=Ct,a.removeFunction=He,a.UTF8ToString=Gt,a.ALLOC_NORMAL=yt,a.allocate=wt,a.allocateUTF8OnStack=ir;var St;ze=function e(){St||qn(),St||(ze=e)};function qn(){function e(){var i;if(!St&&(St=!0,a.calledRun=!0,!K)){if(a.noFSInit||Bn||(Bn=!0,a.stdin=a.stdin,a.stdout=a.stdout,a.stderr=a.stderr,a.stdin?Je("stdin",a.stdin):tr("/dev/tty","/dev/stdin"),a.stdout?Je("stdout",null,a.stdout):tr("/dev/tty","/dev/stdout"),a.stderr?Je("stderr",null,a.stderr):tr("/dev/tty1","/dev/stderr"),Fe("/dev/stdin",0),Fe("/dev/stdout",1),Fe("/dev/stderr",1)),bn=!1,Qt(rn),(i=a.onRuntimeInitialized)==null||i.call(a),a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;){var t=a.postRun.shift();nn.unshift(t)}Qt(nn)}}if(!(0<_e)){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)da();Qt(tn),0<_e||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),e()},1)):e())}}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return qn(),s}),Tt)};typeof At=="object"&&typeof Be=="object"?(Be.exports=_t,Be.exports.default=_t):typeof define=="function"&&define.amd?define([],function(){return _t}):typeof At=="object"&&(At.Module=_t)});var $i={};li($i,{default:()=>zt});module.exports=ci($i);var Ee=require("obsidian");var Te=require("obsidian"),Qn=ui(Kn()),Gn=require("fs"),Jn=require("fs/promises"),kt=class{constructor(o){this.mode="local";this.db=null;this.SQL=null;this.settings=null;this.basePath="";this.apiBaseUrl="";this.app=o}async ensureDBLoaded(o,n,s=!1){var l,a,c,p;if(this.settings=o,this.basePath=n,this.mode=(l=o.mode)!=null?l:"local",this.mode==="remote")return o.apiBaseUrl?(this.apiBaseUrl=o.apiBaseUrl,!0):(new Te.Notice("Remote mode selected, but no API base URL configured."),!1);if(!o.dbFilePath)return new Te.Notice("No local DB path set in plugin settings."),!1;if(!this.db||s)try{this.SQL=await(0,Qn.default)({locateFile:b=>`${n}/${this.app.vault.configDir}/plugins/sqlite-db/${b}`});let m=(0,Gn.readFileSync)(o.dbFilePath);this.db=new this.SQL.Database(m);let h=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' LIMIT 1;");return(p=(c=(a=h==null?void 0:h[0])==null?void 0:a.values)==null?void 0:c[0])!=null&&p[0]?new Te.Notice("DB Loaded."):new Te.Notice("DB Loaded, but found no tables."),!0}catch(m){return this.db=null,this.SQL=null,console.error("DBService: Error initializing/reading DB:",m),new Te.Notice("Error reading DB: "+m.message),!1}else return!0}getDB(){return this.db}async getQuery(o,n=[]){var l,a;if(this.mode==="remote"){let c=await fetch(`${this.apiBaseUrl}/query`,{method:"POST",headers:{"Content-Type":"application/json",...((l=this.settings)==null?void 0:l.cfAccessClientId)&&{"CF-Access-Client-Id":this.settings.cfAccessClientId},...((a=this.settings)==null?void 0:a.cfAccessClientSecret)&&{"CF-Access-Client-Secret":this.settings.cfAccessClientSecret}},body:JSON.stringify({sql:o,params:n})});if(!c.ok)throw new Error(await c.text());return await c.json()}if(!this.db)throw new Error("Database not loaded (local mode).");let s=null;try{s=this.db.prepare(o),s.bind(n);let c=[];for(;s.step();)c.push(s.getAsObject());return c}finally{s&&s.free()}}async runQuery(o,n=[]){var l,a;if(this.mode==="remote"){let c=await fetch(`${this.apiBaseUrl}/execute`,{method:"POST",headers:{"Content-Type":"application/json",...((l=this.settings)==null?void 0:l.cfAccessClientId)&&{"CF-Access-Client-Id":this.settings.cfAccessClientId},...((a=this.settings)==null?void 0:a.cfAccessClientSecret)&&{"CF-Access-Client-Secret":this.settings.cfAccessClientSecret}},body:JSON.stringify({sql:o,params:n})});if(!c.ok)throw new Error(await c.text());return}if(!this.db)throw new Error("Database not loaded (local mode).");let s=null;try{s=this.db.prepare(o),s.bind(n),s.run(),await this._saveDBInternal()}finally{s&&s.free()}}async _saveDBInternal(){if(!this.db){console.error("DBService._saveDBInternal: Cannot save, database not loaded.");return}if(!this.settings||!this.settings.dbFilePath){console.error("DBService._saveDBInternal: Cannot save, settings or DB path missing."),new Te.Notice("Cannot save DB: Path missing.");return}try{let o=this.db.export();await(0,Jn.writeFile)(this.settings.dbFilePath,o)}catch(o){throw console.error(`DBService._saveDBInternal: Error saving database to ${this.settings.dbFilePath}:`,o),new Te.Notice("Error saving database changes!"),o}}generateUuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){let n=Math.random()*16|0;return(o==="x"?n:n&3|8).toString(16)})}closeDB(){if(this.db)try{console.log("DBService: Closing database connection."),this.db.close()}catch(o){console.error("DBService: Error closing database:",o)}finally{this.db=null,this.SQL=null,this.settings=null,this.basePath=""}else this.SQL=null}};var ge=require("obsidian"),It=class extends ge.PluginSettingTab{constructor(n,s){super(n,s);this.plugin=s}display(){let{containerEl:n}=this;n.empty(),new ge.Setting(n).setName("Database mode").setDesc("Choose between local file or remote API").addDropdown(s=>s.addOptions({local:"Local",remote:"Remote"}).setValue(this.plugin.settings.mode).onChange(async l=>{this.plugin.settings.mode=l,await this.plugin.saveSettings()})),new ge.Setting(n).setName("Database file path (local mode)").setDesc("Absolute path to your local SQLite .db file").addText(s=>s.setPlaceholder("/home/user/file.db").setValue(this.plugin.settings.dbFilePath).onChange(async l=>{this.plugin.settings.dbFilePath=l,await this.plugin.saveSettings()})),new ge.Setting(n).setName("API base URL (remote mode)").setDesc("Full base URL to your remote API (e.g., http://localhost:3000/api)").addText(s=>s.setPlaceholder("http://localhost:3000/api").setValue(this.plugin.settings.apiBaseUrl).onChange(async l=>{this.plugin.settings.apiBaseUrl=l,await this.plugin.saveSettings()})),new ge.Setting(n).setName("Journal Folder Path").setDesc("Path to the folder containing your journal notes (relative to vault root).").addText(s=>s.setPlaceholder("e.g., Journals or Notes/Daily").setValue(this.plugin.settings.journalFolderPath).onChange(async l=>{this.plugin.settings.journalFolderPath=l,await this.plugin.saveSettings()})),new ge.Setting(n).setName("Journal Table Name").setDesc("The name of the database table for journal entries.").addText(s=>s.setPlaceholder("e.g., Journals").setValue(this.plugin.settings.journalTableName).onChange(async l=>{this.plugin.settings.journalTableName=l,await this.plugin.saveSettings()})),new ge.Setting(n).setName("CF Access Client ID").setDesc("Cloudflare Access client ID for remote API authentication").addText(s=>s.setPlaceholder("your-client-id").setValue(this.plugin.settings.cfAccessClientId||"").onChange(async l=>{this.plugin.settings.cfAccessClientId=l,await this.plugin.saveSettings()})),new ge.Setting(n).setName("CF Access Client Secret").setDesc("Cloudflare Access client secret for remote API authentication").addText(s=>s.setPlaceholder("your-client-secret").setValue(this.plugin.settings.cfAccessClientSecret||"").onChange(async l=>{this.plugin.settings.cfAccessClientSecret=l,await this.plugin.saveSettings()}))}};var Ue=require("obsidian");var $t=require("obsidian"),Pe=class extends $t.FuzzySuggestModal{constructor(n,s,l){super(n);this.tables=s,this.onChoose=l,this.setPlaceholder("Pick a table...")}getItems(){return this.tables}getItemText(n){return n}onChooseItem(n,s){new $t.Notice(`Selected table: ${n}`),this.onChoose(n)}};async function cr(r,o,n){if(r.mode==="local"){let s=r.getDB();if(!s){new Ue.Notice("No DB loaded. Please open the DB first.");return}let l=s.exec("SELECT name FROM sqlite_master WHERE type='table';");if(!l||l.length===0){new Ue.Notice("No tables found in the DB.");return}let a=l[0].values.map(p=>p[0]);new Pe(n,a,p=>{let m=s.exec(`SELECT * FROM "${p}" LIMIT 10;`);if(!m||m.length===0){o.replaceSelection(`
No rows found in table ${p}.
`);return}let h=m[0].columns,b=m[0].values,y=`
**Columns in "${p}"**
`;y+=h.join(", "),y+=`

**First row**
`,y+=b[0].join(", "),o.replaceSelection(y+`
`)}).open()}else try{let s=await r.getQuery("SELECT name FROM sqlite_master WHERE type='table';");if(!s||s.length===0){new Ue.Notice("No tables found in the DB.");return}let l=s.map(c=>c.name);new Pe(n,l,async c=>{try{let p=await r.getQuery(`SELECT * FROM "${c}" LIMIT 10;`);if(!p||p.length===0){o.replaceSelection(`
No rows found in table ${c}.
`);return}let m=Object.keys(p[0]),h=`
**Columns in "${c}"**
`;h+=m.join(", "),h+=`

**First row**
`,h+=m.map(b=>p[0][b]).join(", "),o.replaceSelection(h+`
`)}catch(p){console.error("Error querying table rows:",p),new Ue.Notice(`Error querying table: ${p.message}`),o.replaceSelection(`
Error querying table ${c}.
`)}}).open()}catch(s){console.error("Error fetching tables:",s),new Ue.Notice(`Error fetching tables: ${s.message}`)}}var ee=require("obsidian");var Yn=require("obsidian"),Xn=require("obsidian"),Mt=class extends Xn.FuzzySuggestModal{constructor(n,s,l){super(n);this.columns=s,this.onChoose=l,this.setPlaceholder("Pick a column to use as filenames...")}getItems(){return this.columns}getItemText(n){return n}onChooseItem(n){new Yn.Notice(`Selected column: ${n}`),this.onChoose(n)}};async function dr(r,o,n){let s=r.getDB();if(!s){new ee.Notice("No DB loaded. Please open the DB first.");return}let l=s.exec(`PRAGMA table_info('${o}');`);if(!l||l.length===0){new ee.Notice(`Could not read columns for table '${o}'.`);return}let a=l[0].values.map(C=>C[1]);if(!a.length){new ee.Notice(`No columns found in table '${o}'.`);return}let p=await(async()=>new Promise(C=>{new Mt(n,a,G=>{C(G)}).open()}))();if(!p){new ee.Notice("No column chosen. Aborting.");return}let m=`${o}-dump`,h=(0,ee.normalizePath)(m),b=n.vault.getAbstractFileByPath(h);if(b&&!(b instanceof ee.TFolder)){new ee.Notice(`A file named "${m}" already exists and is not a folder.`);return}b||(b=await n.vault.createFolder(h));let y=s.exec(`SELECT * FROM "${o}";`);if(!y||y.length===0){new ee.Notice(`No rows found in table "${o}".`);return}let D=y[0],S=D.columns,T=D.values,q=S.indexOf(p);if(q<0){new ee.Notice(`Chosen column '${p}' not found in table.`);return}let R=0;for(let C=0;C<T.length;C++){let H=T[C],G=String(H[q])||`Untitled_${C}`,K=di(G)||`Untitled_${C}`,F=`${h}/${K}.md`,B=1,he=n.vault.getAbstractFileByPath(F);for(;he&&he instanceof ee.TFile;)B++,F=`${h}/${K}_${B}.md`,he=n.vault.getAbstractFileByPath(F);let A=["---"];for(let ue=0;ue<S.length;ue++){let je=S[ue],lt=H[ue]==null?"":String(H[ue]);A.push(`${je}: ${lt.replace(/\n/g,"\\n")}`)}A.push(`---
`);let z=A.join(`
`);try{await n.vault.create(F,z),R++}catch(ue){console.error(`Failed to create file at ${F}:`,ue)}}new ee.Notice(`Created ${R} notes in folder "${m}".`)}function di(r){return r.replace(/[\\\/:*?"<>|]/g,"_").trim()}var X=require("obsidian");async function pr(r,o,n,s){var R;let{vault:l,metadataCache:a}=s;if(!r.getDB()&&r.mode==="local"){new X.Notice("Local DB not loaded.");return}let p=await pi(n,s.vault);if(!p){new X.Notice(`Failed to find or create folder "${n}".`);return}let m=p.children.filter(C=>C instanceof X.TFile&&C.extension==="md"),h=new Map;for(let C of m){let H=(R=a.getFileCache(C))==null?void 0:R.frontmatter;H&&H.uuid&&h.set(H.uuid,{file:C,fmUpdatedAt:H.updatedAt||null,mtime:C.stat.mtime})}let b=`SELECT uuid, date, place, text, createdAt, updatedAt FROM "${o}"`,y=await r.getQuery(b);if(!y||y.length===0){new X.Notice(`No rows found in DB table "${o}".`);return}let D=0,S=0,T=0,q=0;for(let C of y)try{let H=C.uuid,G=C.updatedAt;if(!H||!G){console.warn("Skipping DB row - missing 'uuid' or 'updatedAt'.",C),q++;continue}let K=h.get(H);if(K){let F=K.file,B=K.mtime;new Date(G).getTime()>B+2e3?(console.log(`DB row ${H} is newer than note "${F.path}". Updating note.`),await Zn(C,o,p.path,s,F),S++):T++,h.delete(H)}else console.log(`DB row ${H} not found in notes. Creating new note.`),await Zn(C,o,p.path,s),D++}catch(H){console.error(`Error processing DB row with uuid ${C.uuid}:`,H),new X.Notice(`Error processing DB row ${C.uuid}. Check console.`),q++}new X.Notice(`Sync DB to Notes complete. Created: ${D}, Updated: ${S}, Skipped: ${T}, Errors: ${q}.`)}async function Zn(r,o,n,s,l){let{vault:a}=s,c={uuid:r.uuid,db_table:o,date:r.date,place:r.place,createdAt:r.createdAt,updatedAt:r.updatedAt};Object.keys(c).forEach(b=>(c[b]===null||c[b]===void 0)&&delete c[b]);let p=r.text||"",h=`---
${(0,X.stringifyYaml)(c)}---

${p}`;if(l){let b=await a.cachedRead(l);h!==b&&await a.modify(l,h)}else{let b=r.date?new Date(r.date).toISOString().split("T")[0]:"UnknownDate",y=mi(`Journal ${b}`),D=(0,X.normalizePath)(`${n}/${y}.md`),S=1;for(;a.getAbstractFileByPath(D);)S++,D=(0,X.normalizePath)(`${n}/${y}_${S}.md`);await a.create(D,h)}}async function pi(r,o){let n=(0,X.normalizePath)(r),s=o.getAbstractFileByPath(n);if(s&&!(s instanceof X.TFolder))return new X.Notice(`"${n}" exists but is not a folder.`),null;if(!s)try{s=await o.createFolder(n)}catch(l){return console.error(`Error creating folder "${n}":`,l),null}return s}function mi(r){return r.replace(/[\\\/:*?"<>|]/g,"_").trim()}var oe=require("obsidian");async function mr(r,o,n,s){var D;let{vault:l,metadataCache:a}=s;if(!r.getDB()&&r.mode==="local"){new oe.Notice("Local DB not loaded.");return}let p=l.getAbstractFileByPath((0,oe.normalizePath)(o));if(!p||!(p instanceof oe.TFolder)){new oe.Notice(`Folder "${o}" not found.`);return}let m=p.children.filter(S=>S instanceof oe.TFile&&S.extension==="md"),h=0,b=0,y=0;for(let S of m)try{let T=await l.cachedRead(S),q=((D=a.getFileCache(S))==null?void 0:D.frontmatter)||{},R=S.stat.mtime,C={uuid:q.uuid,date:q.date,place:q.place,text:to(T),createdAt:q.createdAt,updatedAt:q.updatedAt};if(!C.date){let K=hi(S.name);if(K)C.date=K,console.log(`Extracted date from filename for "${S.path}": ${K}`);else{console.warn(`Skipping note "${S.path}" - missing 'date' in frontmatter and filename.`);continue}}let H="skip",G=null;if(C.uuid){let K=`SELECT updatedAt FROM "${n}" WHERE uuid = ?`,F=await r.getQuery(K,[C.uuid]);F&&F.length>0?(G=F[0].updatedAt,R>new Date(G).getTime()?(H="update",console.log(`Note "${S.path}" is newer than DB record. Scheduling UPDATE.`)):console.log(`Note "${S.path}" is up-to-date with DB record. Skipping.`)):(console.warn(`Note "${S.path}" has uuid ${C.uuid} but not found in DB. Scheduling INSERT.`),H="insert",C.uuid=r.generateUuid())}else H="insert",C.uuid=r.generateUuid(),console.log(`Note "${S.path}" has no uuid. Scheduling INSERT with new ID ${C.uuid}.`);if(H==="insert"){let K=new Date().toISOString();C.createdAt=K,C.updatedAt=K;let F=`INSERT INTO "${n}" (uuid, date, place, text, createdAt, updatedAt) VALUES (?, ?, ?, ?, ?, ?)`,B=[C.uuid,C.date,C.place||null,C.text,C.createdAt,C.updatedAt];await r.runQuery(F,B),await eo(S,{uuid:C.uuid,createdAt:C.createdAt,updatedAt:C.updatedAt,...q,date:C.date,place:C.place},T,s),b++}else if(H==="update"){let K=new Date().toISOString();C.updatedAt=K;let F=`UPDATE "${n}" SET date = ?, place = ?, text = ?, updatedAt = ? WHERE uuid = ?`,B=[C.date,C.place||null,C.text,C.updatedAt,C.uuid];await r.runQuery(F,B),await eo(S,{updatedAt:C.updatedAt,...q,date:C.date,place:C.place},T,s),h++}}catch(T){console.error(`Error processing note "${S.path}":`,T),new oe.Notice(`Error syncing note "${S.name}". Check console.`),y++}new oe.Notice(`Sync Notes to DB complete. Inserted: ${b}, Updated: ${h}, Errors: ${y}.`)}function to(r){let o=r.match(/^---\s*([\s\S]*?)\s*---(\s*[\s\S]*)$/);return o?(o[2]||"").trim():r.trim()}async function eo(r,o,n,s){let l=to(n),c=`---
${(0,oe.stringifyYaml)(o)}---

${l}`;c!==n&&(await s.vault.modify(r,c),console.log(`Updated frontmatter for "${r.path}"`))}function hi(r){let o=r.match(/Journal\s+(\d{4}-\d{2}-\d{2})/i);return o&&o[1]?o[1]:null}var no=require("obsidian");function hr(r){let o=r.split(`
`),n={};for(let s of o){let l=s.trim();if(!l)continue;let a=l.split(":").map(c=>c.trim());if(a.length>=2){let c=a[0],p=a.slice(1).join(":").trim();switch(c){case"columns":n.columns=p.split(",").map(b=>b.trim()).join(", ");break;case"filterColumn":case"filterValue":n[c]=p.split(",").map(b=>b.trim());break;case"limit":let m=parseInt(p);isNaN(m)||(n.limit=m);break;case"orderDirection":(p.toLowerCase()==="asc"||p.toLowerCase()==="desc")&&(n.orderDirection=p.toLowerCase());break;case"table":n.table=p;break;case"dateColumn":n.dateColumn=p;break;case"startDate":n.startDate=p;break;case"endDate":n.endDate=p;break;case"orderBy":n.orderBy=p;break;case"displayFormat":let h=p.toLowerCase();h==="list"||h==="table"?n.displayFormat=h:(console.warn(`Invalid displayFormat "${p}", defaulting to 'list'.`),n.displayFormat="list");break}}}return n.table?(n.displayFormat||(n.displayFormat="list"),(Array.isArray(n.filterColumn)||Array.isArray(n.filterValue))&&(!Array.isArray(n.filterColumn)||!Array.isArray(n.filterValue)||n.filterColumn.length!==n.filterValue.length)?(console.error("Mismatch between number of filterColumn and filterValue entries. Filtering might be incorrect."),null):n):null}async function fr(r,o){let n=o.table,s=[];try{if(r.mode==="remote"){let l=await r.getQuery(`PRAGMA table_info("${n}")`);if(!l||l.length===0)return{message:`Unable to fetch column info for table "${n}". It might not exist or there was an issue.`,availableColumns:[]};s=l.map(a=>a.name)}else{let l=r.getDB();if(!l)return{message:"Database not loaded."};let a=l.exec(`PRAGMA table_info("${n}")`);if(!a||a.length===0||!a[0].values||a[0].values.length===0)return{message:`Table "${n}" does not exist or is empty.`};s=a[0].values.map(c=>c[1])}}catch(l){return console.error(`[validateTable] Failed to fetch columns for table "${n}"`,l),{message:`Error fetching column info for table "${n}".`,availableColumns:[]}}if(o.columns){let a=o.columns.split(",").map(c=>c.trim()).filter(c=>!s.includes(c));if(a.length>0)return{message:`The following columns do not exist in table "${n}": ${a.join(", ")}.`,availableColumns:s}}if(o.dateColumn&&!s.includes(o.dateColumn))return{message:`Date column "${o.dateColumn}" does not exist in table "${n}".`,availableColumns:s};if(o.filterColumn){let a=(Array.isArray(o.filterColumn)?o.filterColumn:o.filterColumn.split(",").map(c=>c.trim())).filter(c=>!s.includes(c));if(a.length>0)return{message:`The following filter columns do not exist in table "${n}": ${a.join(", ")}.`,availableColumns:s}}return o.orderBy&&!s.includes(o.orderBy)?{message:`Order by column "${o.orderBy}" does not exist in table "${n}".`,availableColumns:s}:null}function fi(r,o,n){if(!r||!o||!n)return null;try{let s=new Date(n+"T00:00:00Z");if(isNaN(s.getTime()))throw new Error(`Invalid end date format: ${n}`);s.setUTCDate(s.getUTCDate()+1);let l=s.toISOString().split("T")[0];return{clause:`"${r}" >= ? AND "${r}" < ?`,params:[o,l]}}catch(s){return console.error("Error processing date range for SQL query:",s),null}}function Bt(r){let{table:o,columns:n,dateColumn:s,startDate:l,endDate:a,filterColumn:c,filterValue:p,orderBy:m,orderDirection:h,limit:b}=r,y=n?n.split(",").map(R=>`"${R.trim()}"`).join(", "):"*",D=[],S=[];if(c&&p){let R=Array.isArray(c)?c:[c],C=Array.isArray(p)?p:[p];if(R.length!==C.length)throw new Error("Number of filter columns must match number of filter values");R.forEach((H,G)=>{S.push(`"${H}" = ?`),D.push(C[G])})}let T=fi(s,l,a);T&&(S.push(T.clause),D.push(...T.params));let q=`SELECT ${y} FROM "${o}"`;if(S.length>0&&(q+=` WHERE ${S.join(" AND ")}`),m){let R=(h==null?void 0:h.toUpperCase())==="DESC"?"DESC":"ASC";q+=` ORDER BY "${m}" ${R}`}return b!=null&&(q+=" LIMIT ?",D.push(b)),{query:q,queryParams:D}}function gr(r,o){let{columns:n,values:s}=r,l=o.createEl("div");s.forEach(a=>{let c=l.createEl("div");n.forEach((p,m)=>{var b;let h=c.createEl("span");h.createEl("strong",{text:p}),h.createEl("span",{text:": "+String((b=a[m])!=null?b:"")}),c.createEl("br")}),l.createEl("br")})}function ro(r,o){o.empty();let n=o.createEl("table",{cls:"sql-results-table"}),l=n.createEl("thead",{cls:"sql-results-thead"}).createEl("tr",{cls:"sql-results-tr sql-results-header-row"});r.columns.forEach(c=>{l.createEl("th",{text:c,cls:"sql-results-th"})});let a=n.createEl("tbody",{cls:"sql-results-tbody"});r.values.forEach(c=>{let p=a.createEl("tr",{cls:"sql-results-tr"});c.forEach(m=>{let h=m==null?"":String(m);p.createEl("td",{text:h,cls:"sql-results-td"})})})}async function et(r,o,n){let s=hr(o);if(!s){n.createEl("p",{text:"Missing required parameter: table"}),n.createEl("p",{text:"Example usage:"}),n.createEl("pre",{text:`table: tasks
columns: title, status
filterColumn: status, priority
filterValue: active, high
dateColumn: dueDate
startDate: 2024-01-01
endDate: 2024-12-31
limit: 10
orderBy: dueDate
orderDirection: asc`});return}try{let l=await fr(r,s);if(l){n.createEl("p",{text:l.message}),l.availableColumns&&n.createEl("p",{text:`Available columns are: ${l.availableColumns.join(", ")}`});return}let{query:a,queryParams:c}=Bt(s),p=null;if(r.mode==="remote"){let m=await r.getQuery(a,c);if(!(!m||m.length===0)){let h=Object.keys(m[0]),b=m.map(y=>h.map(D=>y[D]));p={columns:h,values:b}}}else{let m=r.getDB();if(!m){new no.Notice("No DB loaded. Please open the DB first."),n.createEl("p",{text:"Database not loaded."});return}let h=m.exec(a,c);!h||h.length===0||h[0].values.length===0||(p=h[0])}if(!p){n.createEl("p",{text:"No rows found matching the criteria."});let m=`Table: "${s.table}"`;(s.startDate||s.endDate)&&(m+=` | Dates: ${s.startDate} to ${s.endDate}`),s.filterColumn&&(m+=` | Filter: ${s.filterColumn}=${s.filterValue}`),n.createEl("p",{text:`Criteria: ${m}`,cls:"sql-block-criteria-summary"});return}n.empty(),s.displayFormat==="table"?ro(p,n):gr(p,n)}catch(l){n.empty(),n.createEl("p",{text:"An error occurred processing the SQL block."}),n.createEl("p",{text:String(l)}),console.error("SQL Block Error:",l);try{let{query:a,queryParams:c}=Bt(s);n.createEl("pre",{text:`Query: ${a}
Params: ${JSON.stringify(c)}`})}catch(a){}}}function br(r){let o=r.split(`
`),n={},s={},l=!1;for(let c of o){let p=c.trim();if(!p)continue;if(p==="chartOptions: {"){l=!0;continue}if(p==="}"){l=!1;continue}if(l){let h=p.match(/(\w+):\s*([^,]+),?$/);if(h){let[,b,y]=h,D=y.trim();D==="true"?D=!0:D==="false"?D=!1:isNaN(Number(D))||(D=Number(D)),s[b]=D}continue}let m=p.split(":").map(h=>h.trim());if(m.length>=2){let h=m[0],b=m.slice(1).join(":").trim();h==="yColumns"?n[h]=b.split(",").map(y=>y.trim()):n[h]=b}}if(!n.table||!n.chartType)return null;let a={table:n.table,chartType:n.chartType,startDate:n.startDate,endDate:n.endDate,chartOptions:Object.keys(s).length>0?s:void 0};switch(n.chartType){case"pie":return!n.categoryColumn||!n.valueColumn?null:{...a,dateColumn:n.dateColumn,chartType:"pie",categoryColumn:n.categoryColumn,valueColumn:n.valueColumn};case"line":case"bar":return!n.xColumn||!n.yColumns?null:{...a,dateColumn:n.dateColumn,chartType:n.chartType,xColumn:n.xColumn,yColumns:Array.isArray(n.yColumns)?n.yColumns:[n.yColumns],categoryColumn:n.categoryColumn};default:return null}}async function vr(r,o){let n=o.table,s=[];try{s=(await r.getQuery(`PRAGMA table_info("${n}")`)).map(p=>p.name)}catch(c){return console.error(`[validateColumns] Failed to fetch columns for table "${n}"`,c),{message:`Unable to fetch column info for table "${n}".`,availableColumns:[]}}let l=[];o.chartType==="pie"?(l=[o.categoryColumn,o.valueColumn],o.dateColumn&&(o.startDate||o.endDate)&&l.push(o.dateColumn)):(l=[o.xColumn,...o.yColumns],o.categoryColumn&&l.push(o.categoryColumn),o.dateColumn&&(o.startDate||o.endDate)&&l.push(o.dateColumn));let a=l.filter(c=>!s.includes(c));return a.length>0?{message:`The following columns do not exist: ${a.join(", ")}`,availableColumns:s}:null}function gi(r,o,n){if(!r||!o||!n)return null;try{let s=new Date(n+"T00:00:00Z");if(isNaN(s.getTime()))throw new Error(`Invalid end date format: ${n}`);s.setUTCDate(s.getUTCDate()+1);let l=s.toISOString().split("T")[0];return{clause:`"${r}" >= ? AND "${r}" < ?`,params:[o,l]}}catch(s){return console.error("Error processing date range for SQL query:",s),null}}function yr(r){let o,n=`FROM "${r.table}"`,s=[],l="",a="",c=[],p=gi(r.dateColumn,r.startDate,r.endDate);switch(p&&(s.push(p.clause),c.push(...p.params)),r.chartType){case"pie":let h=r,y=h.table.toLowerCase()==="time"&&h.valueColumn==="duration"?`SUM(strftime('%s', '1970-01-01T' || "${h.valueColumn}") - strftime('%s', '1970-01-01T00:00:00'))`:`SUM("${h.valueColumn}")`;o=`SELECT "${h.categoryColumn}", ${y} as value`,l=`GROUP BY "${h.categoryColumn}"`,a="ORDER BY value DESC";break;case"line":case"bar":let D=r.yColumns.map(T=>`"${T}"`).join(", "),S=`"${r.xColumn}"`;if(r.categoryColumn){let T=`"${r.categoryColumn}"`;o=`SELECT ${S}, ${T}, ${D}`,a=`ORDER BY ${S}, ${T}`}else o=`SELECT ${S}, ${D}`,a=`ORDER BY ${S}`;break;default:throw new Error("Unsupported chart type")}let m=o+`
`+n;return s.length>0&&(m+=`
WHERE `+s.join(" AND ")),l&&(m+=`
`+l),a&&(m+=`
`+a),{query:m,params:c}}function Y(r,o=1){let n=[`rgba(255, 99, 132, ${o})`,`rgba(54, 162, 235, ${o})`,`rgba(75, 192, 192, ${o})`,`rgba(255, 206, 86, ${o})`,`rgba(153, 102, 255, ${o})`,`rgba(255, 159, 64, ${o})`];return n[r%n.length]}function bi(r){return r.chartType==="pie"}function vi(r){let o=Math.floor(r/3600),n=Math.floor(r%3600/60),s=Math.floor(r%60),l=a=>String(a).padStart(2,"0");return`${l(o)}:${l(n)}:${l(s)}`}function Pt(r,o){if(bi(o)){let l=o.table==="Time"&&o.valueColumn==="duration",a=r.values.map(p=>{let m=p[0],h=p[1];return l?`${m} | ${vi(h)}`:m}),c=[{data:r.values.map(p=>p[1]),label:o.valueColumn}];return{labels:a,datasets:c}}let n,s;if(o.categoryColumn){let{labels:l,datasets:a}=yi(r,o);n=l,s=a}else n=r.values.map(l=>l[0]),s=wi(r,o);return{labels:n,datasets:s}}function yi(r,o){let n=new Map;r.values.forEach(a=>{let c=a[0],p=String(a[1]),m=a[2];n.has(p)||n.set(p,{x:[],y:[]}),n.get(p).x.push(c),n.get(p).y.push(m)});let s=Array.from(n.values())[0].x,l=Array.from(n.entries()).map(([a,c],p)=>({label:a,data:c.y,borderColor:Y(p),backgroundColor:Y(p,.2),fill:!1,tension:.1}));return{labels:s,datasets:l}}function wi(r,o){return o.chartType==="line"?[{label:o.yColumns[0],data:r.values.map(n=>n[1]),borderColor:Y(0),backgroundColor:Y(0,.2),fill:!1,tension:.1}]:o.chartType==="bar"?[{label:o.yColumns[0],data:r.values.map(n=>n[1]),backgroundColor:Y(0,.6),hoverBackgroundColor:Y(0,.8),borderColor:Y(0),borderWidth:1}]:o.yColumns.map((n,s)=>({label:n,data:r.values.map(l=>l[s+1]),borderColor:Y(s),backgroundColor:Y(s,.2),fill:!1,tension:.1}))}function wr(r,o,n={}){let l={...{fill:!1,tension:.3,pointRadius:3,pointHoverRadius:5,showLegend:!0,tooltips:!0,animations:!0},...n};return{type:"line",data:{labels:r,datasets:o.map((a,c)=>({...a,fill:l.fill,tension:l.tension,pointRadius:l.pointRadius,pointHoverRadius:l.pointHoverRadius,borderWidth:2,pointBackgroundColor:a.borderColor,pointBorderColor:a.borderColor,pointBorderWidth:1,hoverBorderWidth:2,hoverBorderColor:a.borderColor}))},options:{responsive:!0,interaction:{intersect:!1,mode:"index"},animations:l.animations?{tension:{duration:1e3,easing:"linear",from:.4,to:.3}}:!1,plugins:{legend:{display:l.showLegend,position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12}}},tooltip:{enabled:l.tooltips,backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:13},bodyFont:{size:12},padding:10,cornerRadius:4,displayColors:!0}},scales:{x:{grid:{display:!0,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.1)"},ticks:{font:{size:11},maxRotation:45,minRotation:45}},y:{beginAtZero:!0,min:l.yAxisMin,max:l.yAxisMax,grid:{display:!0,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.1)"},ticks:{font:{size:11}}}}}}}function oo(r,o,n={}){let l={...{stacked:!1,showLegend:!0,horizontal:!1,barThickness:8,borderRadius:4,tooltips:!0,animations:!0},...n},a=l.horizontal?"y":"x",c=l.horizontal?"x":"y";return{type:"bar",data:{labels:r,datasets:o.map((p,m)=>({...p,backgroundColor:Y(m,.6),hoverBackgroundColor:Y(m,.8)}))},options:{responsive:!0,indexAxis:a,interaction:{intersect:!1,mode:"index"},animations:l.animations?{numbers:{type:"number",duration:600,easing:"easeOutQuart"},x:{type:"number",duration:300,from:0},y:{type:"number",duration:300,from:0}}:!1,plugins:{legend:{display:l.showLegend,position:"top",labels:{usePointStyle:!1,padding:15,font:{size:12},generateLabels:p=>p.data.datasets.map((h,b)=>({text:h.label,fillStyle:h.backgroundColor,strokeStyle:h.borderColor,lineWidth:0,hidden:!p.isDatasetVisible(b),index:b}))}},tooltip:{enabled:l.tooltips,backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:13},bodyFont:{size:12},padding:10,cornerRadius:4,displayColors:!0,callbacks:{label:function(p){let m=p.dataset.label||"";return m&&(m+=": "),m+=p.parsed[c],m}}}},scales:{[c]:{stacked:l.stacked,beginAtZero:!0,min:l.yAxisMin,max:l.yAxisMax,grid:{display:!0,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.1)"},ticks:{font:{size:11}}},[a]:{stacked:l.stacked,grid:{display:!1,drawBorder:!0,drawTicks:!0},ticks:{font:{size:11},maxRotation:l.horizontal?0:45,minRotation:l.horizontal?0:45}}}}}}function ao(r,o,n={}){let l={...{showLegend:!0,isDoughnut:!1,cutout:50,tooltips:!0,animations:!0,rotation:-90},...n};return{type:l.isDoughnut?"doughnut":"pie",data:{labels:r,datasets:o.map(a=>({...a,backgroundColor:r.map((c,p)=>Y(p,.6)),hoverBackgroundColor:r.map((c,p)=>Y(p,.8)),borderWidth:2,borderColor:r.map((c,p)=>Y(p,1)),hoverBorderWidth:3,hoverBorderColor:r.map((c,p)=>Y(p,1))}))},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:2,rotation:l.rotation,cutout:l.isDoughnut?`${l.cutout}%`:0,animations:l.animations?{animateRotate:!0,animateScale:!0}:!1,layout:{padding:{top:10,bottom:10,left:10,right:l.showLegend?30:10}},plugins:{legend:{display:l.showLegend,position:"right",align:"center",labels:{padding:20,boxWidth:15,boxHeight:15,font:{size:11},generateLabels:a=>{let c=a.data;return c.labels.map((p,m)=>({text:`${p}: ${c.datasets[0].data[m]}`,fillStyle:c.datasets[0].backgroundColor[m],strokeStyle:c.datasets[0].borderColor[m],lineWidth:1,hidden:isNaN(c.datasets[0].data[m]),index:m}))}}},tooltip:{enabled:l.tooltips,backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:12},bodyFont:{size:11},padding:8,cornerRadius:4,callbacks:{label:function(a){let c=a.label||"",p=a.parsed,m=a.dataset.data.reduce((b,y)=>b+y,0),h=(p*100/m).toFixed(1);return`${c}: ${p} (${h}%)`}}}}}}}function io(r,o,n,s){switch(r){case"line":return wr(o,n,s);case"bar":return oo(o,n,s);case"pie":return ao(o,n,s);default:return wr(o,n)}}var so=require("obsidian");async function tt(r,o,n){await s();async function s(){let l=br(o);if(!l){let a=(l==null?void 0:l.chartType)==="pie"?"Required parameters for pie chart are: table, categoryColumn, valueColumn":"Required parameters are: table, xColumn, yColumns";n.createEl("p",{text:a});return}try{let a=await vr(r,l);if(a){n.createEl("p",{text:a.message}),a.availableColumns&&n.createEl("p",{text:`Available columns are: ${a.availableColumns.join(", ")}`});return}let{query:c,params:p}=yr(l),m,h,b;if(r.mode==="remote"){if(m=await r.getQuery(c,p),!m||m.length===0){n.createEl("p",{text:"No data found for the specified parameters."});return}let S=Object.keys(m[0]),T=m.map(R=>S.map(C=>R[C]));({labels:h,datasets:b}=Pt({columns:S,values:T},l))}else{let S=r.getDB();if(!S){new so.Notice("No DB loaded. Please open the DB first."),n.createEl("p",{text:"Database not loaded."});return}let T=S.exec(c,p);if(!T||T.length===0||T[0].values.length===0){n.createEl("p",{text:"No data found for the specified parameters."});return}let q=T[0].columns;m=T[0].values.map(C=>Object.fromEntries(C.map((H,G)=>[q[G],H]))),{labels:h,datasets:b}=Pt(m,l)}let y=io(l.chartType,h,b,l.chartOptions),D=n.createDiv({cls:"obsidian-sql-chart"});window.renderChart(y,D)}catch(a){n.createEl("p",{text:"An error occurred while processing the chart."}),n.createEl("p",{text:String(a)}),console.error(a)}}}var Co=require("obsidian");var Nt=require("obsidian");function lo(r,o,n){let s=document.createElement("div");s.className="calendar-header";let l=s.createEl("button",{text:"\u2190",cls:"clickable-icon"});l.setAttribute("aria-label","Previous month"),l.onclick=o;let a=s.createEl("span",{cls:"calendar-title",text:r.toLocaleString("default",{month:"long",year:"numeric",timeZone:"UTC"})}),c=s.createEl("button",{text:"\u2192",cls:"clickable-icon"});return c.setAttribute("aria-label","Next month"),c.onclick=n,s}function uo(r=!1){let o=document.createElement("div");return o.className="calendar-weekdays",r&&o.createDiv({cls:"week-number-header",text:"W#"}),["Mo","Tu","We","Th","Fr","Sa","Su"].forEach(s=>o.createDiv({cls:"calendar-weekday",text:s})),o}function Ne(r){let o=new Date(r.getTime());o.setHours(0,0,0,0),o.setDate(o.getDate()+3-(o.getDay()+6)%7);let n=new Date(o.getFullYear(),0,4);return 1+Math.round(((o.getTime()-n.getTime())/864e5-3+(n.getDay()+6)%7)/7)}function Oe(r){return!r||isNaN(r.getTime())?"":`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}function pe(r){if(!r||!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;let o=r.split("-").map(Number),n=new Date(Date.UTC(o[0],o[1]-1,o[2]));return isNaN(n.getTime())?null:n}function Le(r){return!r||isNaN(r.getTime())?"Invalid Date":r.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}function co(r,o,n,s){let l=document.createElement("div");l.className="calendar-grid";let a=r.getUTCFullYear(),c=r.getUTCMonth(),m=(new Date(Date.UTC(a,c,1)).getUTCDay()+6)%7,h=new Date(Date.UTC(a,c+1,0)).getUTCDate(),b=1-m,y=-1;for(;b<=h;){let D=new Date(Date.UTC(a,c,b>0?b:1)),S=Ne(D);if(l.children.length%8===0){let T=document.createElement("div");T.className="week-number",T.textContent=`${String(S).padStart(2,"0")}`,l.appendChild(T),y=S}for(let T=0;T<7;T++){let q=document.createElement("div");if(q.className="calendar-day-cell",b<1||b>h)q.classList.add("empty");else{let R=new Date(Date.UTC(a,c,b)),C=document.createElement("button");C.textContent=String(b),C.className="calendar-day",C.setAttribute("aria-label",R.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})),R.getTime()===o.getTime()?(C.classList.add("selected"),C.setAttribute("aria-selected","true")):C.setAttribute("aria-selected","false"),R.getTime()===n.getTime()&&C.classList.add("today"),C.onclick=()=>{s(R)},q.appendChild(C)}l.appendChild(q),b++}}return l}function po(r,o){let n=document.createElement("div");n.className="calendar-footer";let s=n.createEl("span",{cls:"selected-date-display"});s.textContent=`Selected: ${Le(r)}`;let l=n.createEl("button",{text:"Select",cls:"mod-cta"});return l.onclick=o,n}var Re=class extends Nt.Modal{constructor(n,s,l){super(n);this._handlePrevMonth=()=>{this.currentDisplayMonth.setUTCMonth(this.currentDisplayMonth.getUTCMonth()-1),this.render()};this._handleNextMonth=()=>{this.currentDisplayMonth.setUTCMonth(this.currentDisplayMonth.getUTCMonth()+1),this.render()};this._handleDateSelect=n=>{this.selectedDateObj=n,this.render()};this._confirmSelection=()=>{let n=Oe(this.selectedDateObj);this.onSelectCallback(n),new Nt.Notice(`Date set to ${n}`),this.close()};this.onSelectCallback=l;let a=pe(s);this.selectedDateObj=a&&!isNaN(a.getTime())?a:new Date,this.selectedDateObj.setUTCHours(0,0,0,0),this.today=new Date,this.today.setUTCHours(0,0,0,0),this.currentDisplayMonth=new Date(Date.UTC(this.selectedDateObj.getUTCFullYear(),this.selectedDateObj.getUTCMonth(),1))}onOpen(){this.contentEl.addClass("custom-datepicker-modal-content"),this.render()}render(){let{contentEl:n}=this;n.empty();let s=lo(this.currentDisplayMonth,this._handlePrevMonth,this._handleNextMonth);n.appendChild(s);let l=uo(!0);n.appendChild(l);let a=co(this.currentDisplayMonth,this.selectedDateObj,this.today,this._handleDateSelect);n.appendChild(a);let c=po(this.selectedDateObj,this._confirmSelection);n.appendChild(c)}onClose(){this.contentEl.empty()}};function Cr(r,o){let n=pe(r);if(!n)return console.error(`[DatePeriodUtils] Invalid reference date: ${r}`),null;let s,l;switch(o){case"day":s=new Date(n),l=new Date(n);break;case"week":s=new Date(n);let a=s.getUTCDay(),c=a===0?-6:1-a;s.setUTCDate(s.getUTCDate()+c),l=new Date(s),l.setUTCDate(l.getUTCDate()+6);break;case"month":s=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),1)),l=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth()+1,0));break;case"quarter":let p=n.getUTCMonth(),m=Math.floor(p/3)*3;s=new Date(Date.UTC(n.getUTCFullYear(),m,1)),l=new Date(Date.UTC(n.getUTCFullYear(),m+3,0));break;case"year":s=new Date(Date.UTC(n.getUTCFullYear(),0,1)),l=new Date(Date.UTC(n.getUTCFullYear(),11,31));break;default:return console.error(`[DatePeriodUtils] Unsupported period type: ${o}`),null}return{startDate:Oe(s),endDate:Oe(l)}}function Er(r,o,n){let s=pe(r);if(!s)return null;let l=n==="next"?1:-1;switch(o){case"day":s.setUTCDate(s.getUTCDate()+l);break;case"week":s.setUTCDate(s.getUTCDate()+7*l);break;case"month":s.setUTCMonth(s.getUTCMonth()+l,1);break;case"quarter":s.setUTCMonth(s.getUTCMonth()+3*l,1);break;case"year":s.setUTCFullYear(s.getUTCFullYear()+l,0,1);break;default:return null}return Oe(s)}function Sr(r,o){let n=pe(r);if(!n)return"Invalid Date";let s=Cr(r,o);if(!s)return Le(n);let l=pe(s.startDate),a=pe(s.endDate);if(!l||!a)return Le(n);let c=l.getUTCFullYear(),p={month:"short",day:"numeric",timeZone:"UTC"};switch(o){case"day":return Le(n);case"week":{let m=Ne(n),h=l.toLocaleDateString(void 0,p),b=a.toLocaleDateString(void 0,p);return`Week ${m}: ${h} - ${b}, ${c}`}case"month":return n.toLocaleDateString(void 0,{month:"long",year:"numeric",timeZone:"UTC"});case"quarter":{let m=Math.floor(n.getUTCMonth()/3)+1,h=l.toLocaleDateString(void 0,p),b=a.toLocaleDateString(void 0,p);return`Q${m} ${c}`}case"year":return String(c);default:return Le(n)}}function Ci(r){let o=r.getUTCFullYear(),n=r.getUTCMonth(),s=Ne(r);return s===1&&n===11?`${o+1}-W01`:s>=52&&n===0?`${o-1}-W${String(s).padStart(2,"0")}`:`${o}-W${String(s).padStart(2,"0")}`}function Ei(r){let o=r.getUTCFullYear(),n=Math.floor(r.getUTCMonth()/3)+1;return`${o}-Q${n}`}function Si(r){let o=r.getUTCFullYear(),n=String(r.getUTCMonth()+1).padStart(2,"0");return`${o}-${n}`}function mo(r,o){let n=pe(r);if(!n)return console.warn(`[getPeriodId] Invalid date: ${r}, returning date string.`),r;switch(o){case"day":return r;case"week":return Ci(n);case"month":return Si(n);case"quarter":return Ei(n);case"year":return String(n.getUTCFullYear());default:return console.warn(`[getPeriodId] Unknown period type: ${o}, returning ISO date.`),r}}function xr(r,o){o.selectedDate=r}function ho(r,o){return()=>{let n=r.currentPeriod,s=Er(r.selectedDate,n,"prev");s?xr(s,r):console.error("[DateNavHandlers] Failed to calculate previous date.")}}function fo(r,o){return()=>{let n=r.currentPeriod,s=Er(r.selectedDate,n,"next");s?xr(s,r):console.error("[DateNavHandlers] Failed to calculate next date.")}}function go(r,o){return()=>{new Re(o,r.selectedDate,n=>{xr(n,r)}).open()}}function bo(r,o,n,s){r.empty();let l=r.createDiv({cls:"date-navigator-wrapper"}),a=l.createDiv({cls:"date-nav-row"}),c=`Previous ${n}`,p=`Next ${n}`,m=a.createEl("button",{text:"\u2190",cls:"clickable-icon date-nav-button date-nav-prev"});m.setAttribute("aria-label",c),m.addEventListener("click",s.handlePrev);let h=a.createEl("h1",{cls:"date-navigator-display"});h.textContent=Sr(o,n);let b=a.createEl("button",{text:"\u2192",cls:"clickable-icon date-nav-button date-nav-next"});b.setAttribute("aria-label",p),b.addEventListener("click",s.handleNext);let D=l.createDiv({cls:"date-controls-row"}).createEl("button",{text:"Select Date",cls:"date-nav-open-modal"});return D.addEventListener("click",s.handleOpenModal),{wrapper:l,prevButton:m,nextButton:b,dateDisplay:h,openModalButton:D}}function vo(r,o,n){let s=Sr(o,n);if(!r)return;r.dateDisplay&&(r.dateDisplay.textContent=s);let l=`Previous ${n.charAt(0).toUpperCase()+n.slice(1)}`,a=`Next ${n.charAt(0).toUpperCase()+n.slice(1)}`;r.prevButton&&r.prevButton.setAttribute("aria-label",l),r.nextButton&&r.nextButton.setAttribute("aria-label",a),r.periodSelect&&r.periodSelect.value!==n&&(r.periodSelect.value=n)}var yo=require("obsidian");var se="plugin-date-changed",Dr=class{constructor(){this.app=null}initialize(o,n,s="day"){this.app=o,this._currentPeriod=s,this.selectedDate=n!=null?n:new Date().toISOString().split("T")[0],this._periodStartDate||this._recalculatePeriodRange(),console.log("[PluginState] Initialized.")}get selectedDate(){return this._selectedDate}get currentPeriod(){return this._currentPeriod}get periodStartDate(){return this._periodStartDate}get periodEndDate(){return this._periodEndDate}set selectedDate(o){(!o||!/^\d{4}-\d{2}-\d{2}$/.test(o))&&(console.warn(`[PluginState] Invalid date format passed to selectedDate setter: ${o}`),o=new Date().toISOString().split("T")[0]),this._selectedDate!==o&&(this._selectedDate=o,this._recalculatePeriodRange(),this._dispatchDateChangeEventAndRefreshViews())}set currentPeriod(o){this._currentPeriod!==o&&(this._currentPeriod=o,this._recalculatePeriodRange(),this._dispatchDateChangeEventAndRefreshViews())}_recalculatePeriodRange(){let o=Cr(this._selectedDate,this._currentPeriod);o?(this._periodStartDate=o.startDate,this._periodEndDate=o.endDate):(console.error("[PluginState] Failed to calculate period range."),this._periodStartDate=this._selectedDate,this._periodEndDate=this._selectedDate)}_dispatchDateChangeEventAndRefreshViews(){document.dispatchEvent(new CustomEvent(se,{detail:{}})),this.app?this.app.workspace.getLeavesOfType("markdown").forEach(o=>{var n;o.view instanceof yo.MarkdownView&&((n=o.view.previewMode)==null||n.rerender(!0))}):console.warn("[PluginState] Cannot refresh views: App instance not available.")}},me=new Dr;function wo(r){return o=>{if(o.target instanceof HTMLSelectElement){let n=o.target.value;["day","week","month","quarter","year"].includes(n)?r.currentPeriod=n:console.warn(`[PeriodChangeHandler] Invalid period selected: ${n}`)}}}var Lt=class{constructor(o){this.elements=null;this.isListening=!1;this._updateDisplay=()=>{let o=this.pluginState.selectedDate,n=this.pluginState.currentPeriod;vo(this.elements,o,n)};var n;if(this.app=o.app,this.pluginState=o.pluginState,this.containerEl=o.containerEl,this.configPeriod=(n=o.period)!=null?n:"day",!this.app||!this.pluginState||!this.containerEl)throw new Error("DateNavigator missing required options (app, pluginState, containerEl).");this.pluginState.currentPeriod!==this.configPeriod&&(this.pluginState.currentPeriod=this.configPeriod),this._buildUI(),this._setupStateListener()}_buildUI(){let o=this.pluginState.currentPeriod,n=this.pluginState.selectedDate,s={handlePrev:ho(this.pluginState,this.app),handleNext:fo(this.pluginState,this.app),handleOpenModal:go(this.pluginState,this.app),handlePeriodChange:wo(this.pluginState)};this.elements=bo(this.containerEl,n,o,s)}_setupStateListener(){this.isListening||(document.addEventListener(se,this._updateDisplay),this.isListening=!0)}destroy(){this.containerEl.empty(),this.elements=null}};function xi(r){let o=r==null?void 0:r.trim().toLowerCase();return o?["day","week","month","quarter","year"].includes(o)?o:(console.warn(`[DateNavigatorRenderer] Invalid period specified in code block source: "${o}". Defaulting.`),null):null}var rt=class extends Co.MarkdownRenderChild{constructor(n,s,l){var a;super(n);this.appInstance=s;this.source=l;this.navigator=null;this.initialPeriod=(a=xi(l))!=null?a:"day"}onload(){this.containerEl.empty(),this.containerEl.addClass("date-navigator-container-wrapper");try{this.navigator=new Lt({app:this.appInstance,pluginState:me,containerEl:this.containerEl,period:this.initialPeriod})}catch(n){console.error("[DateNavigatorRenderer] Failed to create DateNavigator:",n),this.containerEl.setText("Error loading date navigator component.")}}onunload(){var n;(n=this.navigator)==null||n.destroy(),this.navigator=null}};var qt=require("obsidian");async function Tr(r,o){let n=r.getDB();if(!n)return new qt.Notice("No DB loaded. Please open the DB first."),null;let s=n.exec("SELECT name FROM sqlite_master WHERE type='table';");if(!s||s.length===0)return new qt.Notice("No tables found in the DB."),null;let l=s[0].values.map(a=>a[0]);return l.length?new Promise(a=>{new Pe(o,l,p=>{a(p)}).open()}):(new qt.Notice("No tables found in the DB."),null)}var ae=r=>{let o=r,n=me.selectedDate,s=me.currentPeriod,l=me.periodStartDate,a=me.periodEndDate,c=mo(n,s),p=pe(n);return o=o.replace(/@startDate/g,l),o=o.replace(/@endDate/g,a),o=o.replace(/@periodId/g,c),o=o.replace(/@date/g,n),p?(o=o.replace(/@year/g,String(p.getUTCFullYear())),o=o.replace(/@quarter/g,String(Math.floor(p.getUTCMonth()/3)+1)),o=o.replace(/@month/g,String(p.getUTCMonth()+1).padStart(2,"0")),o=o.replace(/@week/g,c.startsWith(p.getUTCFullYear()+"-W")?c.split("-")[1]:"W"+String(Ne(p)).padStart(2,"0")),o=o.replace(/@day/g,String(p.getUTCDate()).padStart(2,"0"))):o=o.replace(/@year|@quarter|@month|@week|@day/g,""),o};function _r(){let r="custom-datepicker-styles";if(document.getElementById(r))return;let o=document.createElement("style");o.id=r,o.textContent=`
		/* Style the modal content area */
		.custom-datepicker-modal-content {
			padding: var(--size-4-4) var(--size-4-6); /* Consistent padding */
		}

		/* Header: Title and Navigation Buttons */
		.calendar-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: var(--size-4-3); /* Space below header */
		}
		.calendar-title {
			font-weight: var(--font-bold);
			font-size: var(--font-ui-large);
		}
		.calendar-header button.clickable-icon {
			/* Use Obsidian's icon button style */
            padding: var(--size-4-1) var(--size-4-2);
            font-size: var(--font-ui-large); /* Make arrows bigger */
            line-height: 1;
		}

		/* Weekday Headers Row */
		.calendar-weekdays {
			display: grid;
			grid-template-columns: 36px repeat(7, 1fr); /* Week# + 7 days */
			gap: var(--size-4-1);
			padding-bottom: var(--size-4-1);
			border-bottom: 1px solid var(--background-modifier-border);
			margin-bottom: var(--size-4-2);
		}
		.calendar-weekday,
		.week-number-header {
			text-align: center;
			font-weight: var(--font-semibold);
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			line-height: 1; /* Ensure consistent height */
		}
        .week-number-header {
            font-style: italic;
        }

		/* Calendar Grid: Week Numbers and Day Cells */
		.calendar-grid {
			display: grid;
			grid-template-columns: 36px repeat(7, 1fr); /* Week# + 7 days */
			gap: var(--size-4-1); /* Gap between cells */
            align-items: center; /* Vertically center content in grid rows */
		}

		/* Individual cell container (holds button or is empty) */
		.calendar-day-cell {
			display: flex; /* Center button inside */
			justify-content: center;
			align-items: center;
            aspect-ratio: 1 / 1; /* Make cells squareish */
            min-height: 30px; /* Ensure minimum height */
		}
        .calendar-day-cell.empty {
            /* Style for empty cells (before/after month) */
            /* background-color: var(--background-secondary); */ /* Subtle background */
            /* opacity: 0.5; */
            /* Or just leave them blank */
        }


		/* Week Number Cells in the main grid */
		.week-number {
			text-align: center;
			font-size: var(--font-ui-smaller);
			color: var(--text-faint);
			font-style: italic;
            align-self: center; /* Align vertically in grid row */
            padding: 0 var(--size-4-1); /* Add some horizontal padding */
            line-height: var(--line-height-normal);
		}

		/* Day Buttons */
		.calendar-day {
			display: flex;
			align-items: center;
			justify-content: center;
			width: 100%; /* Fill cell width */
            height: 100%; /* Fill cell height */
			padding: var(--size-4-1);
			border: 1px solid transparent; /* Reserve space for border */
			border-radius: var(--radius-s);
			background-color: var(--background-secondary);
			color: var(--text-normal);
			font-size: var(--font-ui-small);
			cursor: pointer;
			transition: all 0.1s ease-in-out;
            line-height: 1; /* Prevent text pushing button size */
		}

		.calendar-day:hover {
			background-color: var(--background-modifier-hover);
			color: var(--text-normal); /* Keep text readable on hover */
            border-color: var(--background-modifier-border-hover);
		}

        /* Today's Date Indicator */
        .calendar-day.today {
            border-color: var(--text-accent); /* Use accent color for border */
            /* Optional: Add a subtle background or different font weight */
            /* background-color: var(--background-primary-alt); */
            /* font-weight: var(--font-bold); */
        }

		/* Selected Date Styling */
		.calendar-day.selected {
			background-color: var(--interactive-accent); /* Use theme's accent color */
			color: var(--text-on-accent);
			font-weight: var(--font-bold);
            border-color: var(--interactive-accent-hover); /* Slightly darker border */
		}
        .calendar-day.selected:hover {
            background-color: var(--interactive-accent-hover); /* Darken on hover */
            color: var(--text-on-accent);
        }

        /* Today and Selected */
        .calendar-day.today.selected {
             /* Optional: Make combo distinct if needed, e.g., thicker border */
             /* border-width: 2px; */
        }


		/* Footer Area */
		.calendar-footer {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-top: var(--size-4-3); /* Space above footer */
            padding-top: var(--size-4-2);
            border-top: 1px solid var(--background-modifier-border);
		}
        .selected-date-display {
            font-size: var(--font-ui-small);
            color: var(--text-muted);
        }

		.calendar-footer button {
			/* Let .mod-cta handle primary button style */
			/* Add margin if needed */
			/* margin-left: var(--size-4-2); */
		}

	`,document.head.appendChild(o)}var Ar="sqlitedb-date-navigator-styles",Ve="date-navigator-container-wrapper";function Di(){return`
        .${Ve} {
            padding-bottom: var(--size-4-2);
            border-bottom: 1px solid var(--background-modifier-border);
        }

        .${Ve} .date-navigator-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--size-4-2);
        }

        .${Ve} .date-nav-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            width: 100%;
        }

        .${Ve} .date-nav-button {
            font-size: 2.5rem;
            width: 3rem;
            height: 3rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-normal);
            transition: color 0.2s ease, transform 0.2s ease;
        }

        .${Ve} .date-nav-button:hover {
            color: var(--text-accent);
            transform: scale(1.2);
        }

        .${Ve} h1.date-navigator-display {
            margin: 0;
            text-align: center;
            font-size: var(--font-heading-1);
            color: var(--text-normal);
            white-space: nowrap;
            min-width: 15ch;
            padding: 0 1rem;
        }
    `}function kr(){if(document.getElementById(Ar))return;let r=document.createElement("style");r.id=Ar,r.textContent=Di(),document.head.appendChild(r)}function Ir(){let r=document.getElementById(Ar);r&&r.remove()}var Eo="sqlite-db-time-picker-styles";function Ti(){return`
        .time-picker-modal-content {
            padding: var(--size-4-4) var(--size-4-6);
        }
        .time-picker-modal-content h2 {
            text-align: center;
            margin-bottom: var(--size-4-4);
        }
        /* Style the setting containing the dropdowns */
        .time-picker-controls .setting-item-control {
            display: flex;
            justify-content: center; /* Center the dropdowns */
            align-items: center;
            gap: var(--size-4-1); /* Space between hour, :, minute */
        }
        .time-picker-select {
            min-width: 60px; /* Give dropdowns some width */
            text-align: center;
        }
        .time-picker-separator {
            font-size: var(--font-ui-large);
            font-weight: bold;
            line-height: var(--input-height); /* Align with dropdowns */
            padding: 0 var(--size-4-1);
        }
         /* Style the setting containing the buttons */
        .time-picker-actions {
            margin-top: var(--size-4-4);
            border-top: 1px solid var(--background-modifier-border);
            padding-top: var(--size-4-3);
        }
        .time-picker-actions .setting-item-control {
             justify-content: flex-end; /* Align buttons right */
        }
    `}function $r(){if(document.getElementById(Eo))return;let r=document.createElement("style");r.id=Eo,r.textContent=Ti(),document.head.appendChild(r)}function L(r){if(!/^[a-zA-Z0-9_]+$/.test(r))throw new Error(`Invalid identifier used: "${r}". Only alphanumeric and underscores allowed.`);return`"${r}"`}var Mr=/^[a-zA-Z0-9_]+$/;function Br(r){if(!r.table||!r.habitKey||!r.date)throw new Error(`Missing required identifying arguments: table='${r.table}', habitKey='${r.habitKey}', date='${r.date}'`);if(!r.habitIdCol||!Mr.test(r.habitIdCol))throw new Error(`Invalid or missing habit ID column name: '${r.habitIdCol}'`);if(!r.valueCol||!Mr.test(r.valueCol))throw new Error(`Invalid or missing value column name: '${r.valueCol}'`);if(!r.dateCol||!Mr.test(r.dateCol))throw new Error(`Invalid or missing date column name: '${r.dateCol}'`)}function So(r){if(Br(r),typeof r.newValue!="number"||r.newValue<0)throw new Error(`Invalid newValue for update: '${r.newValue}' (must be a non-negative number)`)}var Ft=class{constructor(o){if(!o)throw new Error("HabitDataService requires a valid DBService instance.");this.dbService=o}async fetchHabitValue(o){var n;try{Br(o);let s=L(o.table),l=L(o.habitIdCol),a=L(o.valueCol),c=L(o.dateCol),p=`SELECT ${a} AS value FROM ${s} WHERE ${l} = ? AND ${c} = ?`,m=[o.habitKey,o.date],h=await this.dbService.getQuery(p,m),b=(n=h==null?void 0:h[0])==null?void 0:n.value;return typeof b=="number"?b:0}catch(s){throw console.error(`[HabitDataService] Error in fetchHabitValue for ${o.habitKey}:`,s),s}}async updateHabitValue(o){var n;try{So(o);let s=L(o.table),l=L(o.habitIdCol),a=L(o.valueCol),c=L(o.dateCol),p=L("updatedAt");let m=new Date().toISOString(),h;try{let b=`SELECT uuid FROM ${s} WHERE ${l} = ? AND ${c} = ?`,y=await this.dbService.getQuery(b,[o.habitKey,o.date]);h=(n=y==null?void 0:y[0])==null?void 0:n.uuid}catch(b){if(b instanceof Error&&/no such column|does not exist/i.test(b.message)&&b.message.includes("uuid"))console.log(`[HabitDataService] Info: Optional 'uuid' column not found in table '${o.table}'. Proceeding with standard upsert.`),h=void 0;else throw console.error(`[HabitDataService] Error fetching potential UUID for ${o.habitKey} on ${o.date}:`,b),b}if(h&&typeof h=="string"){let b=`UPDATE ${s} SET ${a} = ?, ${p} = ? WHERE uuid = ?`,y=[o.newValue,m,h];await this.dbService.runQuery(b,y)}else{let b=`
                    INSERT INTO ${s} (${l}, ${c}, ${a}, ${p})
                    VALUES (?, ?, ?, ?)
                    ON CONFLICT(${l}, ${c}) DO UPDATE SET
                        ${a} = excluded.${a},
                        ${p} = excluded.${p};
                `,y=[o.habitKey,o.date,o.newValue,m];await this.dbService.runQuery(b,y)}}catch(s){throw console.error(`[HabitDataService] Error in updateHabitValue for ${o.habitKey}:`,s),s instanceof Error&&s.message.includes("ON CONFLICT clause does not match")?(console.error(`//! DB Constraint Error: Table '${o.table}' needs a UNIQUE index/key on (${o.habitIdCol}, ${o.dateCol}). Run: CREATE UNIQUE INDEX IF NOT EXISTS idx_habit_date ON ${L(o.table)} (${L(o.habitIdCol)}, ${L(o.dateCol)});`),new Error(`Missing UNIQUE constraint on (${o.habitIdCol}, ${o.dateCol}) in table ${o.table}. ${s.message}`)):s}}};function xo(){return`
        :host { display: inline-flex; vertical-align: middle; }
        .habit-wrapper {
            display: flex; align-items: center; gap: 0.5em;
            font-family: var(--font-text); padding: 2px 5px;
            border: 1px solid transparent; border-radius: 4px;
            transition: border-color 0.2s ease-in-out, background-color 0.2s ease-in-out;
        }
        .habit-label { white-space: nowrap; }
        button {
            background-color: var(--background-secondary); color: var(--text-normal);
            border: 1px solid var(--background-modifier-border); padding: 1px 7px;
            font-size: var(--font-ui-small); cursor: pointer; font-weight: bold;
            border-radius: 4px; line-height: 1.2; min-width: 20px;
        }
        button:hover {
            background-color: var(--background-modifier-hover); border-color: var(--interactive-accent-hover);
            color: var(--text-accent-hover);
        }
        button:active { background-color: var(--background-modifier-active); color: var(--text-accent); }
        .habit-value {
            min-width: 2ch; text-align: center; font-weight: bold;
            padding: 0 2px; color: var(--text-normal);
        }
    `}function Do(r){if(!r){console.error("[HabitCounterStyles] Cannot apply styles: ShadowRoot is null.");return}let o=document.createElement("style");o.textContent=xo(),r.appendChild(o)}function To(r,o){if(!r)throw new Error("Cannot build DOM: ShadowRoot is null.");if(!o||typeof o.handleDecrement!="function"||typeof o.handleIncrement!="function")throw new Error("Cannot build DOM: Invalid event handlers provided.");let n=document.createElement("div");n.className="habit-wrapper";let s=document.createElement("span");s.className="habit-label";let l=document.createElement("button");l.textContent="\u2212",l.addEventListener("click",o.handleDecrement);let a=document.createElement("button");a.textContent="+",a.addEventListener("click",o.handleIncrement);let c=document.createElement("span");return c.className="habit-value",c.textContent="...",n.append(s,l,c,a),r.append(n),{wrapper:n,valueDisplay:c,labelElement:s,minusButton:l,plusButton:a}}function _o(r){return()=>{r._updateData(-1).catch(o=>{console.error(`[HabitCounterClickHandler ${r.habitKey}] Error during decrement update:`,o)})}}function Ao(r){return()=>{r._updateData(1).catch(o=>{console.error(`[HabitCounterClickHandler ${r.habitKey}] Error during increment update:`,o)})}}function le(r){return r==="@date"?me.selectedDate:r}async function Pr(r){if(!r.habitDataService||!r.table||!r.habitKey){console.error(`[LoadHabitData ${r.habitKey}] Cannot load data: Missing service, table, or habitKey.`),r.showErrorState("Load Error");return}let o={table:r.table,habitKey:r.habitKey,date:le(r.initialDate),habitIdCol:r.habitIdCol,valueCol:r.valueCol,dateCol:r.dateCol};try{let n=await r.habitDataService.fetchHabitValue(o);r._updateDisplay(n)}catch(n){console.error(`[LoadHabitData ${r.habitKey}] Failed to load data:`,n),r.showErrorState("Load Error")}}var Nr=require("obsidian");async function ko(r,o){if(!r.habitDataService||!r.table||!r.habitKey){console.error(`[UpdateHabitData ${r.habitKey}] Cannot update data: Missing service, table, or habitKey.`),r.showErrorState("Save Error"),new Nr.Notice("Cannot update habit: Setup incomplete.");return}let n=typeof r.currentValue=="number"?r.currentValue:0,s=Math.max(0,n+o),l={table:r.table,habitKey:r.habitKey,date:le(r.initialDate),newValue:s,habitIdCol:r.habitIdCol,valueCol:r.valueCol,dateCol:r.dateCol};try{await r.habitDataService.updateHabitValue(l),r._updateDisplay(s),r.clearErrorState()}catch(a){console.error(`[UpdateHabitData ${r.habitKey}] Failed to update data:`,a),r.showErrorState("Save Error"),new Nr.Notice(`Error saving value for ${r.habitKey}`)}}function Lr(r,o){r.valueDisplay?r.valueDisplay.textContent=String(o):console.error("[HabitCounterUI] valueDisplay element not found for update.")}function qr(r,o,n){if(r.labelElement){let s=`${o} ${n}:`;r.labelElement.textContent=s}else console.error("[HabitCounterUI] updateStaticUI: labelElement was null.");r.minusButton&&r.minusButton.setAttribute("aria-label",`Decrease ${n} value`),r.plusButton&&r.plusButton.setAttribute("aria-label",`Increase ${n} value`)}function Io(r,o="Error"){Lr(r,"ERR"),r.wrapper&&(r.wrapper.style.borderColor="var(--text-error)",r.wrapper.style.backgroundColor="var(--background-secondary-alt)",r.wrapper.setAttribute("title",o))}function $o(r){r.wrapper&&r.wrapper.style.borderColor!=="transparent"&&(r.wrapper.style.borderColor="transparent",r.wrapper.style.backgroundColor="",r.wrapper.removeAttribute("title"))}var nt=class extends HTMLElement{constructor(){super(...arguments);this.habitKey="";this.initialDate="";this.emoji="";this.table="";this.habitIdCol="";this.valueCol="";this.dateCol="";this.currentValue=0;this._initialLoadTriggered=!1;this._isInitialized=!1;this.habitDataService=null;this._isListeningForDateChanges=!1;this._handleGlobalDateChange=n=>{var l;if(!(n instanceof CustomEvent))return;let s=(l=n.detail)==null?void 0:l.newIsoDate;this.initialDate==="@date"&&Pr(this).catch(a=>{console.error(`[HabitCounter Component ${this.habitKey}] Error reloading data after date change:`,a)})}}connectedCallback(){if(this._isInitialized)return;let n={handleDecrement:_o(this),handleIncrement:Ao(this)};this.uiElements=To(this.attachShadow({mode:"open"}),n),Do(this.shadowRoot),this._setupDateChangeListener(),this._isInitialized=!0}disconnectedCallback(){document.removeEventListener(se,this._handleGlobalDateChange),this._isListeningForDateChanges=!1}setDbService(n){if(!n){console.error("[HabitCounter Component] Invalid DBService provided."),this.showErrorState("Setup Error");return}try{this.habitDataService=new Ft(n)}catch(s){console.error("[HabitCounter Component] Failed to initialize HabitDataService:",s),this.showErrorState("Setup Error");return}this._readAttributesAndInitLoad()}_readAttributesAndInitLoad(){var n,s,l,a,c,p,m;this.habitKey=(n=this.getAttribute("habit"))!=null?n:"",this.initialDate=(s=this.getAttribute("date"))!=null?s:"@date",this.emoji=(l=this.getAttribute("emoji"))!=null?l:"\u2753",this.table=(a=this.getAttribute("table"))!=null?a:"",this.habitIdCol=(c=this.getAttribute("data-habit-id-col"))!=null?c:"",this.valueCol=(p=this.getAttribute("data-value-col"))!=null?p:"",this.dateCol=(m=this.getAttribute("data-date-col"))!=null?m:"",requestAnimationFrame(()=>{if(qr(this.uiElements,this.emoji,this.habitKey),!this.table||!this.habitKey||!this.habitIdCol||!this.valueCol||!this.dateCol){console.warn(`[HabitCounter Component ${this.habitKey}] Missing one or more required attributes: table, habit, data-habit-id-col, data-value-col, data-date-col.`),this.showErrorState("Config Error"),qr(this.uiElements,this.emoji,this.habitKey||"Config Error");return}this._initialLoadTriggered?console.log(`[HabitCounter Component ${this.habitKey}] Initial load already triggered.`):(this._initialLoadTriggered=!0,Pr(this).catch(h=>console.error("Unhandled error during initial load:",h)))})}_setupDateChangeListener(){this.getAttribute("date")==="@date"&&!this._isListeningForDateChanges&&(document.addEventListener(se,this._handleGlobalDateChange),this._isListeningForDateChanges=!0)}async _updateData(n){await ko(this,n)}_updateDisplay(n){this.currentValue=n,Lr(this.uiElements,n),this.clearErrorState()}showErrorState(n){Io(this.uiElements,n)}clearErrorState(){$o(this.uiElements)}};customElements.get("habit-counter")||customElements.define("habit-counter",nt);customElements.get("habit-counter")||customElements.define("habit-counter",nt);var Fr=(r,o)=>{r.querySelectorAll("span.habit-counter-placeholder").forEach(s=>{if(!(s instanceof HTMLElement))return;let l=s.dataset.habit,a=s.dataset.date,c=s.dataset.emoji,p=s.dataset.table,m=s.dataset.habitIdCol,h=s.dataset.valueCol,b=s.dataset.dateCol;if(!l||!p||!m||!h||!b){console.warn("[HabitCounter Reg] Placeholder missing one or more required data attributes (habit, table, habit-id-col, value-col, date-col):",s),s.textContent="[Config Error]";return}try{let y=document.createElement("habit-counter");y.setAttribute("habit",l),y.setAttribute("table",p),a?y.setAttribute("date",a):y.setAttribute("date","@date"),c&&y.setAttribute("emoji",c),y.setAttribute("data-habit-id-col",m),y.setAttribute("data-value-col",h),y.setAttribute("data-date-col",b),y.setDbService(o),s.replaceWith(y)}catch(y){console.error(`[HabitCounter Reg] Error processing placeholder for habit "${l}":`,y,s),s.textContent="[Error Loading Counter]"}})};var Hr=/^[a-zA-Z0-9_]+$/;function Ur(r){if(!r.table||!r.habitKey||!r.date)throw new Error(`Missing required identifying arguments: table='${r.table}', key='${r.habitKey}', date='${r.date}'`);if(!r.habitIdCol||!Hr.test(r.habitIdCol))throw new Error(`Invalid or missing key ID column name: '${r.habitIdCol}'`);if(!r.valueCol||!Hr.test(r.valueCol))throw new Error(`Invalid or missing value column name: '${r.valueCol}'`);if(!r.dateCol||!Hr.test(r.dateCol))throw new Error(`Invalid or missing date column name: '${r.dateCol}'`)}function Mo(r){if(Ur(r),r.newValue!==0&&r.newValue!==1)throw new Error(`Invalid newValue for boolean upsert: '${r.newValue}' (must be 0 or 1)`)}var Ht=class{constructor(o){if(!o)throw new Error("BooleanSwitchDataService requires a valid DBService instance.");this.dbService=o}async fetchBooleanValue(o){var n;try{Ur(o);let s=L(o.table),l=L(o.habitIdCol),a=L(o.valueCol),c=L(o.dateCol),p=`SELECT ${a} AS value FROM ${s} WHERE ${l} = ? AND ${c} = ?`,m=[o.habitKey,o.date],h=await this.dbService.getQuery(p,m);return((n=h==null?void 0:h[0])==null?void 0:n.value)===1?1:0}catch(s){throw console.error(`[BoolDataService] Error in fetchBooleanValue for ${o.habitKey}:`,s),s}}async upsertBooleanValue(o){var n;try{Mo(o);let s=L(o.table),l=L(o.habitIdCol),a=L(o.valueCol),c=L(o.dateCol),p=L("updatedAt");let m=new Date().toISOString(),h;try{let b=`SELECT uuid FROM ${s} WHERE ${l} = ? AND ${c} = ?`,y=await this.dbService.getQuery(b,[o.habitKey,o.date]);h=(n=y==null?void 0:y[0])==null?void 0:n.uuid}catch(b){if(b instanceof Error&&/no such column|does not exist/i.test(b.message)&&b.message.includes("uuid"))console.log(`[BoolDataService] Info: Optional 'uuid' column not found in table '${o.table}'. Proceeding with standard upsert.`),h=void 0;else throw console.error(`[BoolDataService] Error fetching potential UUID for ${o.habitKey} on ${o.date}:`,b),b}if(h){let b=`UPDATE ${s} SET ${a} = ?, ${p} = ? WHERE uuid = ?`,y=[o.newValue,m,h];await this.dbService.runQuery(b,y)}else{let b=`
                    INSERT INTO ${s} (${l}, ${c}, ${a}, ${p})
                    VALUES (?, ?, ?, ?)
                    ON CONFLICT(${l}, ${c}) DO UPDATE
                    SET ${a} = excluded.${a},
                        ${p} = excluded.${p};
                `,y=[o.habitKey,o.date,o.newValue,m];await this.dbService.runQuery(b,y)}}catch(s){throw console.error(`[BoolDataService] Error in upsertBooleanValue for ${o.habitKey}:`,s),s instanceof Error&&s.message.includes("ON CONFLICT clause does not match")?(console.error(`//! DB Constraint Error: Table '${o.table}' needs a UNIQUE index/key on (${o.habitIdCol}, ${o.dateCol}). Run: CREATE UNIQUE INDEX IF NOT EXISTS idx_habit_date ON ${L(o.table)} (${L(o.habitIdCol)}, ${L(o.dateCol)});`),new Error(`Missing UNIQUE constraint on (${o.habitIdCol}, ${o.dateCol}) in table ${o.table}. ${s.message}`)):s}}};function Bo(){return`
        :host {
            display: inline-flex; /* Align items horizontally */
            align-items: center;
            gap: 0.6em; /* Space between label and switch */
            font-family: var(--font-text);
            cursor: pointer; /* Make the whole thing clickable */
            user-select: none; /* Prevent text selection */
        }

        .switch-wrapper {
             display: contents; /* Don't add extra layout */
        }

        .switch-label {
            /* Styles for the emoji + text label */
            white-space: nowrap;
            color: var(--text-normal);
            line-height: 1.2; /* Align better with switch */
        }

        /* Basic Checkbox Styling (Foundation) */
        input[type="checkbox"] {
            appearance: none; /* Remove default OS styling */
            -webkit-appearance: none;
            -moz-appearance: none;
            position: relative; /* For positioning pseudo-elements */
            width: 36px; /* Width of the switch */
            height: 20px; /* Height of the switch */
            background-color: var(--background-modifier-border); /* Off state background */
            border-radius: 10px; /* Rounded corners */
            cursor: pointer;
            outline: none;
            transition: background-color 0.2s ease-in-out;
            vertical-align: middle; /* Align with text */
            margin: 0; /* Remove default margin */
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* Styling the 'thumb' or 'knob' of the switch */
        input[type="checkbox"]::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px; /* Size of the knob */
            height: 16px;
            background-color: var(--background-primary); /* Knob color */
            border-radius: 50%; /* Make it round */
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: transform 0.2s ease-in-out;
        }

        /* Styling when the switch is checked (On state) */
        input[type="checkbox"]:checked {
            background-color: var(--interactive-accent); /* Use accent color for on state */
        }

        /* Moving the knob when checked */
        input[type="checkbox"]:checked::before {
            transform: translateX(16px); /* Move knob to the right */
        }

        /* Focus state for accessibility */
        input[type="checkbox"]:focus-visible {
            box-shadow: 0 0 0 2px var(--background-primary), 0 0 0 4px var(--interactive-accent-hover);
        }

        /* Disabled state */
        input[type="checkbox"]:disabled {
            background-color: var(--background-modifier-border-hover);
            cursor: not-allowed;
            opacity: 0.6;
        }
        input[type="checkbox"]:disabled::before {
            background-color: var(--background-modifier-border);
        }
        :host([aria-disabled="true"]) { /* Style host when disabled */
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Error state indication (optional, applied to host or wrapper) */
        :host(.error) {
            /* e.g., outline: 1px solid var(--text-error); */
            /* e.g., border-radius: var(--radius-s); */
        }
    `}function Po(r){if(!r){console.error("[BooleanSwitchStyles] Cannot apply styles: ShadowRoot is null.");return}let o=document.createElement("style");o.textContent=Bo(),r.appendChild(o)}function No(r,o,n){if(!r)throw new Error("Cannot build DOM: ShadowRoot is null.");let s=document.createElement("div");s.className="switch-wrapper";let l=document.createElement("input");l.type="checkbox",l.id=`bool-switch-${o}`,l.className="bool-switch-input",l.setAttribute("role","switch"),l.addEventListener("change",n);let a=document.createElement("label");return a.htmlFor=l.id,a.className="switch-label",s.append(a,l),r.append(s),{wrapper:s,labelElement:a,checkboxElement:l}}function Lo(r){return o=>{r._updateData().catch(n=>{console.error(`[BooleanSwitchChangeHandler ${r.habitKey}] Error during update:`,n),o.target instanceof HTMLInputElement&&(o.target.checked=!o.target.checked)})}}async function Or(r){if(!r.booleanDataService||!r.table||!r.habitKey||!r.habitIdCol||!r.valueCol||!r.dateCol){console.error(`[LoadBooleanValue ${r.habitKey}] Cannot load data: Missing required properties.`),r.showErrorState("Load Error - Config");return}let o=le(r.initialDate),n={table:r.table,habitKey:r.habitKey,date:o,habitIdCol:r.habitIdCol,valueCol:r.valueCol,dateCol:r.dateCol};try{let s=await r.booleanDataService.fetchBooleanValue(n);r._updateDisplay(s)}catch(s){console.error(`[LoadBooleanValue ${r.habitKey}] Failed to load data:`,s),r.showErrorState("Load Error - DB")}}var Rr=require("obsidian");async function qo(r){if(!r.booleanDataService||!r.table||!r.habitKey||!r.habitIdCol||!r.valueCol||!r.dateCol){console.error(`[UpsertBooleanValue ${r.habitKey}] Cannot update data: Missing required properties.`),r.showErrorState("Save Error - Config"),new Rr.Notice("Cannot update switch: Configuration incomplete.");return}let o=r.currentValue===1?0:1,n={table:r.table,habitKey:r.habitKey,date:le(r.initialDate),newValue:o,habitIdCol:r.habitIdCol,valueCol:r.valueCol,dateCol:r.dateCol};try{await r.booleanDataService.upsertBooleanValue(n),r._updateDisplay(o),r.clearErrorState()}catch(s){console.error(`[UpsertBooleanValue ${r.habitKey}] Failed to upsert data:`,s),r.showErrorState("Save Error - DB"),new Rr.Notice(`Error saving switch state for ${r.habitKey}`)}}function Fo(r,o){r.checkboxElement?(r.checkboxElement.checked=o,r.checkboxElement.setAttribute("aria-checked",String(o))):console.error("[BooleanSwitchUI] checkboxElement not found for state update.")}function Vr(r,o,n){r.labelElement?r.labelElement.textContent=`${o} ${n}:`:console.error("[BooleanSwitchUI] labelElement not found for static update.")}function Ho(r,o,n="Error"){o.checkboxElement&&(o.checkboxElement.disabled=!0),r.classList.add("error"),r.setAttribute("aria-disabled","true"),r.setAttribute("title",n)}function Uo(r,o){o.checkboxElement&&(o.checkboxElement.disabled=!1),r.classList.remove("error"),r.removeAttribute("aria-disabled"),r.removeAttribute("title")}var _i=0,ot=class extends HTMLElement{constructor(){super();this.habitKey="";this.initialDate="";this.emoji="";this.table="";this.currentValue=0;this._initialLoadTriggered=!1;this._isInitialized=!1;this.habitIdCol="";this.valueCol="";this.dateCol="";this.booleanDataService=null;this._isListeningForDateChanges=!1;this._handleGlobalDateChange=n=>{var l;if(!(n instanceof CustomEvent)){console.log(`[BooleanSwitch ${this.habitKey}] Event was not CustomEvent.`);return}let s=(l=n.detail)==null?void 0:l.newIsoDate;this.initialDate==="@date"&&Or(this).catch(a=>{console.error(`[BooleanSwitch ${this.habitKey}] Error reloading data after date change:`,a)})};this.uniqueId=`bs-${_i++}`}connectedCallback(){if(this._isInitialized)return;let n=Lo(this);this.uiElements=No(this.attachShadow({mode:"open"}),this.uniqueId,n),Po(this.shadowRoot),this._isInitialized=!0}disconnectedCallback(){this._isListeningForDateChanges&&(document.removeEventListener(se,this._handleGlobalDateChange),this._isListeningForDateChanges=!1)}setDbService(n){if(!n){this.showErrorState("Setup Error");return}try{this.booleanDataService=new Ht(n)}catch(s){this.showErrorState("Setup Error");return}this._readAttributesAndInitLoad()}_readAttributesAndInitLoad(){var n,s,l,a,c,p,m;this.habitKey=(n=this.getAttribute("data-key"))!=null?n:"",this.initialDate=(s=this.getAttribute("data-date"))!=null?s:"@date",this.emoji=(l=this.getAttribute("data-emoji"))!=null?l:"\u2753",this.table=(a=this.getAttribute("data-table"))!=null?a:"",this.habitIdCol=(c=this.getAttribute("data-key-id-col"))!=null?c:"",this.valueCol=(p=this.getAttribute("data-value-col"))!=null?p:"",this.dateCol=(m=this.getAttribute("data-date-col"))!=null?m:"",this._setupDateChangeListener(),requestAnimationFrame(()=>{if(Vr(this.uiElements,this.emoji,this.habitKey),!this.table||!this.habitKey||!this.habitIdCol||!this.valueCol||!this.dateCol){console.warn(`[HabitCounter Component ${this.habitKey}] Missing one or more required attributes: table, habit, data-habit-id-col, data-value-col, data-date-col.`),this.showErrorState("Config Error"),Vr(this.uiElements,this.emoji,this.habitKey||"Config Error");return}this._initialLoadTriggered?console.log(`[BooleanSwitch Component ${this.habitKey}] Initial load already triggered.`):(this._initialLoadTriggered=!0,Or(this).catch(h=>console.error("Unhandled error during initial load:",h)))})}_setupDateChangeListener(){this.initialDate==="@date"&&!this._isListeningForDateChanges&&(document.addEventListener(se,this._handleGlobalDateChange),this._isListeningForDateChanges=!0)}async _updateData(){await qo(this)}_updateDisplay(n){this.currentValue=n,Fo(this.uiElements,n===1),this.clearErrorState(),this._enableSwitch()}showErrorState(n){Ho(this,this.uiElements,n)}clearErrorState(){Uo(this,this.uiElements)}_enableSwitch(){this.uiElements.checkboxElement&&(this.uiElements.checkboxElement.disabled=!1),this.removeAttribute("aria-disabled")}_disableSwitch(){this.uiElements.checkboxElement&&(this.uiElements.checkboxElement.disabled=!0),this.setAttribute("aria-disabled","true")}};customElements.get("boolean-switch")||customElements.define("boolean-switch",ot);customElements.get("boolean-switch")||customElements.define("boolean-switch",ot);var jr=(r,o)=>{r.querySelectorAll("span.boolean-switch-placeholder").forEach(s=>{if(!(s instanceof HTMLElement))return;let l=s.dataset.habit,a=s.dataset.date,c=s.dataset.emoji,p=s.dataset.table,m=s.dataset.habitIdCol,h=s.dataset.valueCol,b=s.dataset.dateCol;if(!l||!p||!m||!h||!b){console.warn("[BooleanSwitch Reg] Placeholder missing one or more required data attributes (habitKey, table, habitIdCol, valueCol, dateCol):",s),s.textContent="[Config Error]";return}try{let y=document.createElement("boolean-switch");y.setAttribute("data-key",l),y.setAttribute("data-table",p),a?y.setAttribute("data-date",a):y.setAttribute("data-date","@date"),c&&y.setAttribute("data-emoji",c),y.setAttribute("data-key-id-col",m),y.setAttribute("data-value-col",h),y.setAttribute("data-date-col",b),y.setDbService(o),s.replaceWith(y)}catch(y){console.error(`[BooleanSwitch Reg] Error processing placeholder for key "${l}":`,y,s),s.textContent="[Error Loading]"}})};var Oo=/^[a-zA-Z0-9_]+$/;function zr(r){if(!r.table||!r.date)throw new Error(`Missing required identifying arguments: table='${r.table}', date='${r.date}'`);if(!r.valueCol||!Oo.test(r.valueCol))throw new Error(`Invalid or missing value column name: '${r.valueCol}'`);if(!r.dateCol||!Oo.test(r.dateCol))throw new Error(`Invalid or missing date column name: '${r.dateCol}'`)}function Ro(r){if(zr(r),typeof r.newValue!="string"&&r.newValue!==null)throw new Error(`Invalid or missing newValue: '${r.newValue}'`)}var Ut=class{constructor(o){if(!o)throw new Error("TextInputDataService requires a valid DBService instance.");this.dbService=o}async fetchTextValue(o){var n;try{zr(o);let s=L(o.table),l=L(o.valueCol),a=L(o.dateCol),c=`SELECT ${l} AS value FROM ${s} WHERE ${a} = ?`,p=[o.date],m=await this.dbService.getQuery(c,p),h=(n=m==null?void 0:m[0])==null?void 0:n.value;return h!=null?String(h):""}catch(s){throw console.error(`[TextInputDataService] Error in fetchTextValue for ${o.table}:`,s),s}}async upsertTextValue(o){var n;try{Ro(o);let s=L(o.table),l=L(o.valueCol),a=L(o.dateCol),c=L("updatedAt");let p=new Date().toISOString(),m="",h=[],b=o.newValue===""?null:o.newValue,y=`SELECT uuid FROM ${s} WHERE ${a} = ?`,D=await this.dbService.getQuery(y,[o.date]),S=(n=D==null?void 0:D[0])==null?void 0:n.uuid;if(S)m=`UPDATE ${s} SET ${l} = ?, ${c} = ? WHERE uuid = ?`,h=[b,p,S];else{m=`
                    INSERT INTO ${s} (${a}, ${l}, ${c})
                    VALUES (?, ?, ?)
                    ON CONFLICT(${a}) DO UPDATE
                    SET ${l} = excluded.${l}, ${c} = excluded.${c};
                `;h=[o.date,b,p]}await this.dbService.runQuery(m,h)}catch(s){throw console.error(`[TextInputDataService] Error in upsertTextValue for ${o.table}:`,s),s instanceof Error&&s.message.includes("ON CONFLICT clause does not match")?(console.error(`//! DB Constraint Error: Table '${o.table}' needs a UNIQUE index/key on (${o.dateCol}). Run: CREATE UNIQUE INDEX IF NOT EXISTS idx_key_date ON ${L(o.table)} (${L(o.dateCol)});`),new Error(`Missing UNIQUE constraint on (${o.dateCol}) in table ${o.table}. ${s.message}`)):s}}};function Vo(){return`
        :host {
            display: inline-flex; /* Or block, depending on desired layout */
            flex-direction: column; /* Stack label and input/button */
            gap: var(--size-4-1); /* Space between label and input row */
            font-family: var(--font-text);
            width: 100%; /* Default to full width, can be overridden */
        }

        .input-wrapper {
            display: flex;
            align-items: stretch; /* Make input and button same height */
            width: 100%;
        }

        /* Optional Label Styling */
        .input-label {
            font-size: var(--font-ui-small);
            font-weight: var(--font-semibold);
            color: var(--text-muted);
            padding-left: var(--size-4-2); /* Indent slightly */
            margin-bottom: -var(--size-4-1); /* Pull input closer if label exists */
        }

        /* Main Input Element Styling */
        input[type="text"].main-input {
            flex-grow: 1; /* Take available space */
            border: 1px solid var(--background-modifier-border);
            border-radius: var(--radius-m);
            padding: var(--size-4-2) var(--size-4-3);
            font-size: var(--font-ui-normal);
            background-color: var(--background-secondary);
            color: var(--text-normal);
            min-width: 50px; /* Prevent collapsing too small */
            transition: border-color 0.1s ease-in-out;
        }
        input[type="text"].main-input:focus {
            outline: none;
            border-color: var(--interactive-accent);
            box-shadow: 0 0 0 2px var(--interactive-accent-translucent);
        }
        input[type="text"].main-input::placeholder {
            color: var(--text-faint);
            opacity: 0.8;
        }

                input[type="text"].main-input {
            /* ... existing input styles ... */
            /* //? Default cursor */
            cursor: text;
        }

        /* //^ Styles for Button Mode */
        :host([data-button-mode="true"]) input[type="text"].main-input {
            cursor: pointer; /* Indicate clickability */
        }
        :host([data-button-mode="true"]) input[type="text"].main-input:hover {
            background-color: var(--background-modifier-hover);
        }
        /* //? Hide the separate trigger button in button mode */
        :host([data-button-mode="true"]) button.modal-trigger {
            display: none;
        }
        /* //? Ensure input border radius is correct in button mode */
        :host([data-button-mode="true"]) input[type="text"].main-input {
            border-top-right-radius: var(--radius-m);
            border-bottom-right-radius: var(--radius-m);
        }

        /* Modal Trigger Button Styling (if used) */
        button.modal-trigger {
            flex-shrink: 0; /* Don't shrink the button */
            border: 1px solid var(--background-modifier-border);
            border-left: none; /* Join with input */
            background-color: var(--background-secondary);
            color: var(--text-muted);
            padding: 0 var(--size-4-3);
            cursor: pointer;
            border-top-right-radius: var(--radius-m);
            border-bottom-right-radius: var(--radius-m);
            font-size: var(--font-ui-small);
            display: flex;
            align-items: center;
            justify-content: center;
        }
         /* Adjust input border radius when button is present */
        input[type="text"].main-input + button.modal-trigger {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        button.modal-trigger:hover {
            background-color: var(--background-modifier-hover);
            color: var(--text-normal);
        }
        button.modal-trigger:active {
            background-color: var(--background-modifier-active);
        }

        /* Styling when input itself is the trigger (no separate button) */
        :host([data-input-as-trigger="true"]) input[type="text"].main-input {
            cursor: pointer; /* Indicate clickability */
            /* Optionally change appearance slightly */
             /* background-image: url('data:image/svg+xml,...'); // Add dropdown arrow */
        }
        :host([data-input-as-trigger="true"]) input[type="text"].main-input:hover {
             /* background-color: var(--background-modifier-hover); // Subtle hover on input */
        }


        /* Error State */
        :host(.error) input[type="text"].main-input,
        :host(.error) button.modal-trigger {
            border-color: var(--text-error);
        }
        :host(.error) input[type="text"].main-input:focus {
            box-shadow: 0 0 0 2px var(--text-error-translucent);
        }

        /* Disabled State */
        :host([aria-disabled="true"]) {
            opacity: 0.6;
            cursor: not-allowed;
        }
        :host([aria-disabled="true"]) input[type="text"].main-input,
        :host([aria-disabled="true"]) button.modal-trigger {
            background-color: var(--background-modifier-border-hover);
            cursor: not-allowed;
        }
    `}function jo(r){if(!r){console.error("[TextInputStyles] Cannot apply styles: ShadowRoot is null.");return}let o=document.createElement("style");o.textContent=Vo(),r.appendChild(o)}function zo(r,o,n){var m,h;if(!r)throw new Error("Cannot build DOM: ShadowRoot is null.");let s=o.modalType&&o.modalType!=="none"&&!o.isButton,l=null;o.label&&(l=document.createElement("label"),l.textContent=o.label,l.className="input-label",r.appendChild(l));let a=document.createElement("div");a.className="input-wrapper";let c=document.createElement("input");c.type="text",c.className="main-input",c.value=(m=o.initialValueAttr)!=null?m:"",c.placeholder=(h=o.placeholder)!=null?h:"",o.isButton?(c.readOnly=!0,c.addEventListener("click",n.handleModalTrigger),r.host.dataset.buttonMode="true"):c.addEventListener("change",n.handleInputChange),a.appendChild(c);let p=c;if(s){let b=document.createElement("button");b.addEventListener("click",n.handleModalTrigger),a.appendChild(b),p=b}return r.appendChild(a),{wrapper:r.host,labelElement:l,inputElement:c,modalTriggerElement:p}}function Wo(r){return o=>{if(o.target instanceof HTMLInputElement){let n=o.target.value;r._setValue(n,!0)}}}var Zo=require("obsidian");var Wr=require("obsidian");function Ko(r){let o=document.createDocumentFragment();for(let n=0;n<24;n++){let s=document.createElement("option"),l=String(n).padStart(2,"0");s.value=l,s.textContent=l,n===r&&(s.selected=!0),o.appendChild(s)}return o}function Qo(r){let o=document.createDocumentFragment();for(let n=0;n<60;n++){let s=document.createElement("option"),l=String(n).padStart(2,"0");s.value=l,s.textContent=l,n===r&&(s.selected=!0),o.appendChild(s)}return o}function Go(r){let o=12,n=0;if(/^\d{1,2}:\d{1,2}$/.test(r)){let s=r.split(":").map(Number),l=s[0],a=s[1];!isNaN(l)&&l>=0&&l<=23&&(o=l),!isNaN(a)&&a>=0&&a<=59&&(n=a)}return{hour:o,minute:n}}function Jo(r,o){let n=String(r).padStart(2,"0"),s=String(o).padStart(2,"0");return`${n}:${s}`}function Yo(r,o,n){let s=new Wr.Setting(r).setName("Select Time").setClass("time-picker-controls"),l=document.createElement("select");l.classList.add("dropdown","time-picker-select","time-picker-hour"),l.setAttribute("aria-label","Hour"),l.appendChild(Ko(o)),s.controlEl.appendChild(l);let a=document.createElement("span");a.textContent=":",a.addClass("time-picker-separator"),s.controlEl.appendChild(a);let c=document.createElement("select");return c.classList.add("dropdown","time-picker-select","time-picker-minute"),c.setAttribute("aria-label","Minute"),c.appendChild(Qo(n)),s.controlEl.appendChild(c),{hourSelect:l,minuteSelect:c}}function Xo(r,o,n){new Wr.Setting(r).setClass("time-picker-actions").addButton(s=>s.setButtonText("Cancel").onClick(o)).addButton(s=>s.setButtonText("Confirm").setCta().onClick(n))}var Ot=class extends Zo.Modal{constructor(n,s,l){super(n);this.uiElements=null;this._handleCancel=()=>{this.close()};this._handleConfirm=()=>{if(!this.uiElements){console.error("[TimePickerModal] Cannot confirm: UI elements not found.");return}let n=this.uiElements.hourSelect.value,s=this.uiElements.minuteSelect.value,l=Jo(n,s);this.onSelectCallback(l),this.close()};this.onSelectCallback=l;let{hour:a,minute:c}=Go(s!=null?s:"");this.initialHour=a,this.initialMinute=c}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("time-picker-modal-content"),n.createEl("h2",{text:"Select Time"}),this.uiElements=Yo(n,this.initialHour,this.initialMinute),Xo(n,this._handleCancel,this._handleConfirm)}onClose(){this.contentEl.empty(),this.uiElements=null}};function ea(r){return o=>{let n=r.config.modalType,s=r.appInstance,l=r.currentValue,a=r.config.label;if(!s){console.error(`[ModalTriggerHandler ${a}] Cannot open modal: App instance is missing.`);return}switch(n){case"time-picker":new Ot(s,l,p=>{r._setValue(p,!0)}).open();break;case"date-picker":let c=l||new Date().toISOString().split("T")[0];new Re(s,c,p=>{r._setValue(p,!0)}).open();break;case"none":default:console.warn(`[ModalTriggerHandler ${a}] Clicked trigger but modalType is '${n}'.`);break}}}async function Kr(r){var s,l,a;if(!r.textDataService){console.error(`[LoadTextValue ${r.table}] Cannot load data: Missing textDataService.`),r._updateDisplay((s=r.config.initialValueAttr)!=null?s:""),r.showErrorState("Load Error - DB");return}let o=[];if(r.table||o.push("table"),r.date||o.push("date"),r.valueCol||o.push("valueCol"),r.dateCol||o.push("dateCol"),o.length>0){let c=o.join(", ");console.error(`[LoadTextValue ${r.table||"UNKNOWN"}] Cannot load data: Missing required configuration properties: ${c}.`),r._updateDisplay((l=r.config.initialValueAttr)!=null?l:""),r.showErrorState("Load Error - Config");return}let n={table:r.table,date:le(r.date),valueCol:r.valueCol,dateCol:r.dateCol};try{let c=await r.textDataService.fetchTextValue(n);r._updateDisplay(c)}catch(c){console.error(`[LoadTextValue ${r.table}] Failed to load data:`,c),r._updateDisplay((a=r.config.initialValueAttr)!=null?a:""),r.showErrorState("Load Error - DB")}}var Qr=require("obsidian");async function ta(r){if(!r.textDataService||!r.table||!r.date||!r.valueCol||!r.dateCol){console.error(`[UpsertTextValue ${r.table}] Cannot save data: Missing required configuration properties.`),r.showErrorState("Save Error - Config"),new Qr.Notice("Cannot save text input: Configuration incomplete.");return}let o={table:r.table,date:le(r.date),newValue:r.currentValue,valueCol:r.valueCol,dateCol:r.dateCol};try{await r.textDataService.upsertTextValue(o),r.clearErrorState()}catch(n){console.error(`[UpsertTextValue ${r.table}] Failed to save data:`,n),r.showErrorState("Save Error - DB"),new Qr.Notice(`Error saving value for ${r.table}`)}}function ra(r,o){r.inputElement&&r.inputElement.value!==o?r.inputElement.value=o:r.inputElement||console.error("[TextInputUI] inputElement not found for value update.")}function na(r,o){r.labelElement&&o&&(r.labelElement.textContent=o)}function oa(r,o,n="Error"){o.inputElement&&(o.inputElement.disabled=!0,o.inputElement.style.borderColor="var(--text-error)"),o.modalTriggerElement&&o.modalTriggerElement!==o.inputElement&&(o.modalTriggerElement.disabled=!0,o.modalTriggerElement.style.borderColor="var(--text-error)"),r.classList.add("error"),r.setAttribute("aria-disabled","true"),r.setAttribute("title",n)}function aa(r,o){o.inputElement&&(o.inputElement.disabled=!1,o.inputElement.style.borderColor=""),o.modalTriggerElement&&o.modalTriggerElement!==o.inputElement&&(o.modalTriggerElement.disabled=!1,o.modalTriggerElement.style.borderColor=""),r.classList.remove("error"),r.removeAttribute("aria-disabled"),r.removeAttribute("title")}var Ai=0,at=class extends HTMLElement{constructor(){super();this.appInstance=null;this.textDataService=null;this.config={};this.currentValue="";this._isInitialized=!1;this._domBuilt=!1;this._initialLoadTriggered=!1;this.table="";this.date="";this.valueCol="";this.dateCol="";this._isListeningForDateChanges=!1;this._setValue=(n,s=!1)=>{this.currentValue!==n&&(this.currentValue=n,this._updateDisplay(this.currentValue),this.dispatchEvent(new CustomEvent("input-change",{})),s&&this.table&&this.valueCol&&this.dateCol&&ta(this).catch())};this._handleGlobalDateChange=n=>{var l;if(!(n instanceof CustomEvent))return;let s=(l=n.detail)==null?void 0:l.newIsoDate;this.date==="@date"&&(this.classList.add("loading"),this._updateDisplay("..."),Kr(this).catch(a=>{}).finally(()=>{this.classList.remove("loading")}))};this.uniqueId=`ti-${Ai++}`}connectedCallback(){this._isInitialized}disconnectedCallback(){this._isListeningForDateChanges&&(document.removeEventListener(se,this._handleGlobalDateChange),this._isListeningForDateChanges=!1)}setDependencies(n,s){if(!this._isInitialized){if(!n||!s){console.error("[TextInput] Invalid DBService or App instance provided during dependency injection."),this.textContent="[Init Error - Dependencies]";return}this.appInstance=s;try{this.textDataService=new Ut(n)}catch(l){console.error(`[TextInput ${this.uniqueId}] Failed to initialize TextInputDataService:`,l),this.textContent="[Data Service Error]";return}this._readAttributesAndBuildConfig(),this._initializeComponent(),this._isInitialized=!0}}_readAttributesAndBuildConfig(){var n,s,l,a,c,p,m,h,b,y,D,S,T;this.config={label:(n=this.getAttribute("data-label"))!=null?n:void 0,placeholder:(s=this.getAttribute("placeholder"))!=null?s:void 0,initialValueAttr:(l=this.getAttribute("data-initial-value"))!=null?l:"",modalType:(a=this.getAttribute("data-modal-type"))!=null?a:"none",isButton:((c=this.getAttribute("data-is-button"))==null?void 0:c.toLowerCase())==="true",table:(p=this.getAttribute("data-table"))!=null?p:void 0,date:(m=this.getAttribute("data-date"))!=null?m:"@date",valueCol:(h=this.getAttribute("data-value-col"))!=null?h:void 0,dateCol:(b=this.getAttribute("data-date-col"))!=null?b:void 0},this.table=(y=this.config.table)!=null?y:"",this.date=(D=this.config.date)!=null?D:"@date",this.valueCol=(S=this.config.valueCol)!=null?S:"",this.dateCol=(T=this.config.dateCol)!=null?T:"",this._setupDateChangeListener()}_initializeComponent(){if(!this.appInstance){console.error("[TextInput] Cannot initialize component: App instance missing.");return}if(this.shadowRoot){console.warn(`[TextInput ${this.config.label||this.uniqueId}] Already has shadowRoot, skipping DOM build.`);return}let n={handleInputChange:Wo(this),handleModalTrigger:ea(this)};this.uiElements=zo(this.attachShadow({mode:"open"}),this.config,n),jo(this.shadowRoot),this._domBuilt=!0,requestAnimationFrame(()=>{var s,l;na(this.uiElements,this.config.label),this.table&&this.valueCol&&this.dateCol?this._initialLoadTriggered||(this._initialLoadTriggered=!0,Kr(this).catch(a=>console.error(`[TextInput ${this.config.label||this.uniqueId}] Unhandled error during initial load:`,a))):(console.warn(`[TextInput ${this.config.label||this.uniqueId}] Missing required data configuration attributes (table, valueCol, dateCol). Will use initialValueAttr.`),this._updateDisplay((s=this.config.initialValueAttr)!=null?s:""),(l=this._disableInput)==null||l.call(this))})}_setupDateChangeListener(){this.date==="@date"&&!this._isListeningForDateChanges&&(document.addEventListener(se,this._handleGlobalDateChange),this._isListeningForDateChanges=!0)}_updateDisplay(n){this.currentValue=n,ra(this.uiElements,n),this.clearErrorState()}showErrorState(n){oa(this,this.uiElements,n)}clearErrorState(){aa(this,this.uiElements)}_enableInput(){var n;(n=this.uiElements)!=null&&n.inputElement&&(this.uiElements.inputElement.disabled=!1),this.removeAttribute("aria-disabled")}_disableInput(){var n;(n=this.uiElements)!=null&&n.inputElement&&(this.uiElements.inputElement.disabled=!0),this.setAttribute("aria-disabled","true")}};customElements.get("text-input")||customElements.define("text-input",at);customElements.get("text-input")||customElements.define("text-input",at);var Gr=(r,o,n)=>{r.querySelectorAll("span.text-input-placeholder").forEach(l=>{if(!(l instanceof HTMLElement))return;let a={label:l.dataset.label,placeholder:l.dataset.placeholder,initialValue:l.dataset.initialValue,modalType:l.dataset.modalType,isButton:l.dataset.isButton,table:l.dataset.table,date:l.dataset.date,valueCol:l.dataset.valueCol,dateCol:l.dataset.dateCol};try{let c=document.createElement("text-input");Object.entries(a).forEach(([p,m])=>{if(m!==void 0){let h=p.replace(/[A-Z]/g,b=>`-${b.toLowerCase()}`);c.setAttribute(`data-${h}`,m)}}),a.placeholder&&c.setAttribute("placeholder",a.placeholder),c.setDependencies(n,o),l.replaceWith(c)}catch(c){console.error("[TextInput Reg] Error processing placeholder:",c,l),l.textContent="[Error Loading Input]"}})};var it=require("obsidian");var ki=/^---\s*([\s\S]*?)\s*---/,ia=/^(updatedAt:\s*)(.*)$/m,Ii=/^\s*---\s*$/;async function sa(r,o){try{let n=await r.vault.read(o),s=n.match(ki);if(!s||!s[0])return{success:!1,message:"No frontmatter found in this file."};let l=s[0],a=s[1],c=n.substring(l.length),p=new Date().toISOString(),m=null,h,b=a.match(ia);if(b&&b[2]&&(m=b[2].trim()),m===p)return{success:!0,message:`Timestamp already up-to-date (${p.split("T")[1].substring(0,8)}).`};if(b)h=l.replace(ia,`$1${p}`);else{let D=l.trimEnd().split(`
`),S=D.findIndex(T=>Ii.test(T));if(S>0)D.splice(S,0,`updatedAt: ${p}`),h=D.join(`
`),l.endsWith(`
`)&&!h.endsWith(`
`)&&(h+=`
`);else return console.warn(`FileUpdater: Could not find closing '---' to append timestamp in ${o.basename}`),{success:!1,message:"Could not reliably update frontmatter (structure error?)."}}let y=h+c;return y===n?{success:!0,message:"Timestamp already effectively up-to-date."}:(await r.vault.modify(o,y),{success:!0,message:`Updated timestamp for ${o.basename}`})}catch(n){return console.error(`FileUpdater: Error processing file ${o.basename}`,n),{success:!1,message:`Error updating timestamp: ${n.message}`}}}function la(r){let o=document.createElement("button");return o.setText("Update Timestamp"),o.addClass("timestamp-updater-button"),o.style.backgroundColor="var(--interactive-accent)",o.style.color="var(--text-on-accent)",o.style.border="none",o.style.padding="6px 12px",o.style.borderRadius="4px",o.style.cursor="pointer",o.style.fontSize="0.9em",o.addEventListener("click",async n=>{n.stopPropagation(),o.disabled=!0,o.style.opacity="0.7",o.style.cursor="wait";try{await r()}finally{o.disabled=!1,o.style.opacity="1",o.style.cursor="pointer"}}),o}function Jr(r){r.registerMarkdownPostProcessor((o,n)=>{let{app:s}=r,l=o.querySelectorAll(".timestamp-updater-placeholder");l.length!==0&&l.forEach(a=>{let p=la(async()=>{let m=s.workspace.getActiveFile();if(!m||!(m instanceof it.TFile)){new it.Notice("No active file selected.",3e3);return}let h=await sa(s,m);new it.Notice(h.message,h.success?2e3:5e3)});try{a.replaceWith(p)}catch(m){console.error("Error during replaceWith:",m)}})})}function Yr(r,o){r.registerMarkdownPostProcessor(async(n,s)=>{let l=n.querySelectorAll("div.sql-chart-render");l.length!==0&&await Promise.all(Array.from(l).map(async a=>{if(a.dataset.sqlChartProcessed)return;a.dataset.sqlChartProcessed="true";let c=a.innerHTML.trim(),p=ae(c);if(a.innerHTML="",!c){a.createEl("p",{text:"Error: SQL Chart configuration block is empty."}),console.warn("Empty sql-chart-render block found",a);return}let m=a.createEl("p",{text:"Loading chart..."});try{await tt(o,p,a),m.remove()}catch(h){console.error("Error rendering SQL Chart from div:",h),a.innerHTML="",a.createEl("p",{text:"Error rendering SQL Chart:"}),a.createEl("pre",{text:String(h.message||h)})}}))})}function Xr(r,o){r.registerMarkdownPostProcessor(async(n,s)=>{let l=n.querySelectorAll("div.sql-render");l.length!==0&&await Promise.all(Array.from(l).map(async a=>{if(a.dataset.sqlProcessed)return;a.dataset.sqlProcessed="true";let c=a.innerHTML.trim(),p=ae(c);if(a.innerHTML="",!c){a.createEl("p",{text:"Error: SQL Chart configuration block is empty."}),console.warn("Empty sql-render block found",a);return}let m=a.createEl("p",{text:"Loading SQL..."});try{await et(o,p,a),m.remove()}catch(h){console.error("Error rendering SQL from div:",h),a.innerHTML="",a.createEl("p",{text:"Error rendering SQL:"}),a.createEl("pre",{text:String(h.message||h)})}}))})}var st=require("obsidian");var be=require("obsidian");function ua(r){if(!r)return"#000000";r=r.replace("#","");let o,n,s;if(r.length===3)o=parseInt(r.substr(0,1).repeat(2),16),n=parseInt(r.substr(1,1).repeat(2),16),s=parseInt(r.substr(2,1).repeat(2),16);else if(r.length===6)o=parseInt(r.substr(0,2),16),n=parseInt(r.substr(2,2),16),s=parseInt(r.substr(4,2),16);else return console.warn(`Invalid hex color format for contrast calculation: ${r}`),"#000000";return(o*299+n*587+s*114)/1e3>=128?"#000000":"#FFFFFF"}var Rt=class extends be.Modal{constructor(n,s,l){super(n);this.availableTags=[];this.selectedTags=new Set;this.comment="";this.commentComponent=null;this.tagContainerEl=null;this.rating=5;this.ratingComponent=null;this.dbService=s,this.onSaveCallback=l,this.modalEl.addClass("mood-note-entry-modal")}async onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("mood-note-modal-content"),n.createEl("h2",{text:"Add Mood Note \u{1F4AD}"}),await this.fetchTags(),n.createEl("h4",{text:"Select Tags:"}),this.tagContainerEl=n.createDiv({cls:"mood-tag-selection-area"}),this.renderTags(),n.createEl("h4",{text:"Comment"}),n.createEl("p",{text:"Add any details about your current mood.",cls:"setting-item-description"});let s=n.createDiv({cls:"mood-note-comment-container"}),l=new be.TextAreaComponent(s);this.commentComponent=l,l.setPlaceholder("How are you feeling?").setValue(this.comment).onChange(h=>{this.comment=h}),l.inputEl.rows=6,l.inputEl.style.width="100%",l.inputEl.addClass("mood-note-comment-input"),n.createEl("h4",{text:"Rating"}),n.createEl("p",{text:"How would you rate your mood from 1 to 10?",cls:"setting-item-description"});let a=n.createDiv({cls:"mood-note-rating-container"}),c=a.createDiv({cls:"mood-note-slider-container"}),p=c.createEl("input",{type:"range",attr:{min:"1",max:"10",value:this.rating.toString(),step:"1"},cls:"mood-note-slider"}),m=c.createEl("span",{text:this.rating.toString(),cls:"mood-note-rating-value"});p.addEventListener("input",h=>{let b=h.target.value;this.rating=parseInt(b),m.setText(b)}),this.ratingComponent=a,new be.Setting(n).addButton(h=>h.setButtonText("Save Mood Note").setCta().onClick(()=>{this.handleSave()})).addButton(h=>h.setButtonText("Cancel").onClick(()=>{this.close()}))}async fetchTags(){try{let n="SELECT DISTINCT text, color FROM Tags WHERE type = 'moodTag' ORDER BY text ASC;",s=await this.dbService.getQuery(n);s&&Array.isArray(s)?this.availableTags=s.map(l=>({text:l.text,type:"moodTag",color:l.color})):(console.warn("Could not fetch mood tags or no tags found."),this.availableTags=[])}catch(n){console.error("Error fetching mood tags:",n),new be.Notice("Error fetching tags. Check console."),this.availableTags=[]}}renderTags(){if(this.tagContainerEl){if(this.tagContainerEl.empty(),this.tagContainerEl.addClass("tag-checkbox-container"),this.availableTags.length===0){this.tagContainerEl.setText("No mood tags found or configured.");return}this.availableTags.forEach(n=>{var p;let s=`mood-tag-${n.text.replace(/[^a-zA-Z0-9]/g,"-")}`,l=this.selectedTags.has(n.text),a=(p=this.tagContainerEl)==null?void 0:p.createEl("label",{cls:`mood-tag-label ${l?"is-checked":""}`,attr:{for:s}});if(!a){console.error("Failed to create label for tag:",n);return}if(n.color)try{let m=ua(n.color);a.style.backgroundColor=n.color,a.style.color=m,a.style.borderColor=n.color}catch(m){console.error(`Failed to apply color ${n.color} for tag ${n.text}:`,m),a.style.backgroundColor="",a.style.color="",a.style.borderColor=""}else a.style.backgroundColor="",a.style.color="",a.style.borderColor="";let c=a.createEl("input",{type:"checkbox",attr:{id:s}});c.checked=l,a.appendText(n.text),c.onchange=m=>{m.target.checked?(this.selectedTags.add(n.text),a.addClass("is-checked")):(this.selectedTags.delete(n.text),a.removeClass("is-checked"))}})}}async handleSave(){let n=Array.from(this.selectedTags).join(","),s=this.comment.trim(),l=new Date().toISOString(),a=this.dbService.generateUuid(),c=new Date().toISOString(),p=new Date().toISOString(),m=`
            INSERT INTO Mood (uuid, date, tag, comment, rating, createdAt, updatedAt)
            VALUES (?, ?, ?, ?, ?, ?, ?);
        `,h=[a,l,n,s,this.rating,c,p];try{await this.dbService.runQuery(m,h),new be.Notice(`Mood Note saved: ${n||"No tags"} - ${s.substring(0,20)}...`),this.close(),this.onSaveCallback&&this.onSaveCallback()}catch(b){console.error("Error saving mood note:",b),new be.Notice("Failed to save mood note. Check console.")}}onClose(){let{contentEl:n}=this;n.empty()}};function Zr(r,o){r.registerMarkdownPostProcessor((n,s)=>{n.querySelectorAll("div.mood-note-button-placeholder").forEach(a=>{if(a.dataset.processed)return;a.dataset.processed="true";let c=a.dataset.buttonText||"Add Mood Note \u{1F4AD}";a.innerHTML="",a.addClass("mood-note-button-container");let p=new st.ButtonComponent(a).setButtonText(c).setClass("mood-note-trigger-button");p.buttonEl.style.margin="0.5em 0",p.onClick(()=>{console.log("Mood Note Button (from div) Clicked - Dispatching Event"),a.dispatchEvent(new CustomEvent("request-mood-modal",{bubbles:!0,composed:!0}))})})}),r.registerDomEvent(document,"request-mood-modal",n=>{if(!o){new st.Notice("Database service is not ready."),console.error("DBService not initialized/ready when trying to open mood modal via custom event.");return}let s=r.app;new Rt(s,o,()=>{new st.Notice("Mood note saved.")}).open()})}var jt=require("obsidian");var ve=require("obsidian"),Vt=class extends ve.Modal{constructor(n,s,l){super(n);this.inputText="";this.textArea=null;this.dbService=s,this.config=l,this.modalEl.addClass("add-text-entry-modal")}onOpen(){var l;let{contentEl:n}=this;if(n.empty(),n.addClass("add-text-modal-content"),n.createEl("h2",{text:this.config.buttonText||"Add Text Entry"}),n.createEl("p",{text:`Adding to table "${this.config.dbTable}", column "${this.config.textColumn}".`,cls:"add-text-modal-info"}),Object.keys(this.config.extraData).length>0){let a=Object.entries(this.config.extraData).map(([c,p])=>`${c}: ${p}`).join(", ");n.createEl("p",{text:`With fixed data: ${a}`,cls:"add-text-modal-info"})}let s=n.createDiv({cls:"text-area-container"});s.style.display="flex",s.style.justifyContent="center",s.style.width="100%",s.style.margin="1rem 0",this.textArea=new ve.TextAreaComponent(s),this.textArea.setPlaceholder("Type your text here...").setValue(this.inputText).onChange(a=>{this.inputText=a}),this.textArea.inputEl.style.width="90%",this.textArea.inputEl.style.height="150px",this.textArea.inputEl.style.margin="0 auto",this.textArea.inputEl.style.display="block",this.textArea.inputEl.addClass("add-text-entry-input"),new ve.Setting(n).addButton(a=>a.setButtonText("Save Entry").setCta().onClick(()=>{this.handleSave()})).addButton(a=>a.setButtonText("Cancel").onClick(()=>{this.close()})),(l=this.textArea)==null||l.inputEl.focus()}async handleSave(){var S;let n=this.inputText.trim();if(!n){new ve.Notice("Please enter some text."),(S=this.textArea)==null||S.inputEl.focus();return}let s=[this.config.textColumn],l=[n],a=["?"];for(let[T,q]of Object.entries(this.config.extraData))s.push(T),l.push(q),a.push("?");let c=this.dbService.generateUuid(),p=new Date().toISOString();s.push("uuid"),l.push(c),a.push("?"),s.push("createdAt"),s.push("updatedAt"),l.push(p),l.push(p),a.push("?"),a.push("?");let m=`"${this.config.dbTable}"`,h=s.map(T=>`"${T}"`).join(", "),b=a.join(", "),y=`INSERT INTO ${m} (${h}) VALUES (${b});`,D=l;try{await this.dbService.runQuery(y,D),new ve.Notice(`Entry added to "${this.config.dbTable}"!`),this.close()}catch(T){console.error(`Error saving text entry to ${this.config.dbTable}:`,T),new ve.Notice(`Failed to save entry. Check console. Error: ${T.message}`)}}onClose(){let{contentEl:n}=this;n.empty()}};function en(r,o){r.registerMarkdownPostProcessor((n,s)=>{n.querySelectorAll("div.add-text-button-placeholder").forEach(a=>{if(a.dataset.processed)return;a.dataset.processed="true";let c=a.dataset.table,p=a.dataset.column,m=a.dataset.buttonText||`Add Entry to ${c||"Table"}`;if(!c||!p){a.textContent="[Error: add-text-button-placeholder requires data-table and data-column attributes]",a.style.color="var(--text-error)",a.style.fontFamily="monospace",console.error("AddTextProcessor: Missing required attributes data-table or data-column",a);return}let h={};for(let y in a.dataset)y!=="table"&&y!=="column"&&y!=="buttonText"&&y!=="processed"&&(h[y]=a.dataset[y]);a.innerHTML="",a.addClass("add-text-button-container");let b=new jt.ButtonComponent(a).setButtonText(ae(m)).setClass("add-text-trigger-button");b.buttonEl.style.margin="0.5em 0",b.onClick(()=>{let y={};for(let[T,q]of Object.entries(h))y[T]=q!==void 0?ae(q):void 0;let S={buttonText:ae(m),dbTable:c,textColumn:p,extraData:y};a.dispatchEvent(new CustomEvent("request-add-text-modal",{bubbles:!0,composed:!0,detail:S}))})})}),r.registerDomEvent(document,"request-add-text-modal",n=>{if(!(n instanceof CustomEvent)||!n.detail)return;let s=n.detail;if(!o){new jt.Notice("Database service is not ready.");return}let l=r.app;new Vt(l,o,s).open()})}var ca={dbFilePath:"",mode:"local",apiBaseUrl:"",journalFolderPath:"",journalTableName:"",cfAccessClientId:"",cfAccessClientSecret:""};var zt=class extends Ee.Plugin{async onload(){await this.loadSettings(),this.dbService=new kt(this.app),await this.openDatabase(),me.initialize(this.app),_r(),kr(),$r(),this.registerMarkdownPostProcessor((n,s)=>{Fr(n,this.dbService),jr(n,this.dbService),Gr(n,this.app,this.dbService)}),Yr(this,this.dbService),Xr(this,this.dbService),Jr(this),Zr(this,this.dbService),en(this,this.dbService),this.registerMarkdownCodeBlockProcessor("sql",async(n,s,l)=>{let a=ae(n);await et(this.dbService,a,s)}),this.registerMarkdownCodeBlockProcessor("sql-chart",async(n,s,l)=>{let a=ae(n);await tt(this.dbService,a,s)}),this.registerMarkdownCodeBlockProcessor("date-header",(n,s,l)=>{let a=ae(n);l.addChild(new rt(s,this.app,a))}),this.addCommand({id:"inspect-table-structure",name:"Inspect table structure",editorCallback:async(n,s)=>{await cr(this.dbService,n,this.app)}}),this.addCommand({id:"dump-table-to-notes",name:"Dump table to notes",callback:async()=>{let n=await Tr(this.dbService,this.app);n&&await dr(this.dbService,n,this.app)}}),this.addCommand({id:"sync-journal-notes-to-db",name:"Sync Journal Notes -> Database",callback:async()=>{if(!this.settings.journalFolderPath||!this.settings.journalTableName){new Ee.Notice("Please configure Journal folder path and table name in settings.");return}new Ee.Notice("Starting sync: Notes -> DB..."),await mr(this.dbService,this.settings.journalFolderPath,this.settings.journalTableName,this.app)}}),this.addCommand({id:"sync-journal-db-to-notes",name:"Sync Database -> Journal Notes",callback:async()=>{if(!this.settings.journalFolderPath||!this.settings.journalTableName){new Ee.Notice("Please configure Journal folder path and table name in settings.");return}new Ee.Notice("Starting sync: DB -> Notes..."),await pr(this.dbService,this.settings.journalTableName,this.settings.journalFolderPath,this.app)}}),this.addSettingTab(new It(this.app,this))}onunload(){Ir()}async openDatabase(n=!0){let s=this.app.vault.adapter,l;s instanceof Ee.FileSystemAdapter?l=s.getBasePath():l=s.getFullPath(""),this.settings.mode==="local"?await this.dbService.ensureDBLoaded(this.settings,l,n):await this.dbService.ensureDBLoaded(this.settings,l,!1)}async loadSettings(){this.settings=Object.assign({},ca,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
//! 🔒 Hardcoded
//! Requires UNIQUE constraint on (keyIdCol, dateCol)

/* nosourcemap */